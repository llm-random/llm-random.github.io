<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Szymon Antoniak&nbsp;">
<meta name="author" content="Sebastian Jaszczur&nbsp;†">
<meta name="author" content="Michał Krutul">
<meta name="author" content="Maciej Pióro">
<meta name="author" content="Jakub Krajewski">
<meta name="author" content="Jan Ludziejewski">
<meta name="author" content="Tomasz Odrzygóźdź">
<meta name="author" content="Marek Cygan&nbsp;‡">
<meta name="dcterms.date" content="2023-10-06">

<title>llm-random - Mixture of Tokens</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QHXJCKXK7M"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-QHXJCKXK7M', { 'anonymize_ip': true});
</script>
<script charset="utf-8" src="https://cdn.plot.ly/plotly-2.20.0.min.js"> </script>
<style>

  .MK {
  display: none;
  color: brown;
  }
  .MK::before {
  display: none;
  content: "[MK] ";
  }

  .SA {
  display: none;
  color: goldenrod;
  }
  .SA::before {
  display: none;
  content: "[SA] ";
  }

  .MP {
  display: none;
  color: teal;
  }
  .MP::before {
  display: none;
  content: "[MP] ";
  }

  .JK {
  display: none;
  color: coral;
  }
  .JK::before {
  display: none;
  content: "[JK] ";
  }

  .JL {
  display: none;
  color: green;
  }
  .JL::before {
  display: none;
  content: "[JL] ";
  }

  .TO {
  display: none;
  color: purple;
  }
  .TO::before {
  display: none;
  content: "[TO] ";
  }

  .MC {
  display: none;
  color: red;
  }
  .MC::before {
  display: none;
  content: "[MC] ";
  }

  .SJ {
  display: none;
  color: blue;
  }
  .SJ::before {
  display: none;
  content: "[SJ] ";
  }
</style>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">llm-random</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <style>
    .equal-contribution {
      padding: 10px;
      margin: 10px 0px;
      font-size: small;
      text-align: right;
    }

    .MK {
      color: yellow;
    }
  </style>
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Mixture of Tokens</h1>
                      </div>
  </div>

  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-heading">Affiliations</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Szymon Antoniak&nbsp; </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              IDEAS NCBR
            </p>
          <p class="affiliation">
              University of Warsaw
            </p>
        </div>
        <div class="quarto-title-meta-contents">
      <p class="author">Sebastian Jaszczur&nbsp;† </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              IDEAS NCBR
            </p>
          <p class="affiliation">
              University of Warsaw
            </p>
        </div>
        <div class="quarto-title-meta-contents">
      <p class="author">Michał Krutul </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              IDEAS NCBR
            </p>
          <p class="affiliation">
              University of Warsaw
            </p>
        </div>
        <div class="quarto-title-meta-contents">
      <p class="author">Maciej Pióro </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              IDEAS NCBR
            </p>
          <p class="affiliation">
              University of Warsaw
            </p>
        </div>
        <div class="quarto-title-meta-contents">
      <p class="author">Jakub Krajewski </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              IDEAS NCBR
            </p>
          <p class="affiliation">
              University of Warsaw
            </p>
        </div>
        <div class="quarto-title-meta-contents">
      <p class="author">Jan Ludziejewski </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              IDEAS NCBR
            </p>
          <p class="affiliation">
              University of Warsaw
            </p>
        </div>
        <div class="quarto-title-meta-contents">
      <p class="author">Tomasz Odrzygóźdź </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              IDEAS NCBR
            </p>
          <p class="affiliation">
              University of Warsaw
            </p>
        </div>
        <div class="quarto-title-meta-contents">
      <p class="author">Marek Cygan&nbsp;‡ </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              University of Warsaw
            </p>
          <p class="affiliation">
              Nomagic
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 6, 2023</p>
      </div>
    </div>
    
      
    </div>
    

  

  <div class="equal-contribution">
    † initial idea and project supervision
    <br> ‡ research direction and high-level supervision
    <!-- * equal contribution
    <br /> † initial idea and project supervision
    <br /> ‡ research direction and high-level supervision
    <br /> ♭  -->
  </div> 
  

  <script>
    function replaceTextWithYellowColor() {
      var elements = document.getElementsByClassName("MK");

      for (var i = 0; i < elements.length; i++) {
        elements[i].style.color = "yellow";
      }
    }
  </script>

</header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">

<!-- Taken from https://github.com/quarto-dev/quarto-cli/blob/a5a81f5d2afa2664f8748ac9ae5e70b4a0a2baf7/src/resources/formats/html/templates/banner/title-block.html -->



<!-- # TEST

[new text]{.SA}~~old text~~

[new text]{.MK}~~old text~~

[new text]{.MP}~~old text~~

[new text]{.JK}~~old text~~

[new text]{.JL}~~old text~~

[new text]{.TO}~~old text~~

[new text]{.SJ}~~old text~~

[new text]{.MC}~~old text~~

# Standardization 
-  feed-forward 
- American  -->
<p><span class="SA">GENERAL TODOS: grammarly, go over and rephrase, align and make clearer the Methods section, make mail, tweet, settle on contribution attributions,</span></p>
<p><span class="SJ">zastanowić się&nbsp;nad kolejnością autorów, głównie SJ</span></p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Mixture of Experts (MoE) architectures have recently garnerned considerable attention for their ability to increase the size of Transformer models while keeping the computational cost of training and inference constant. The most successful MoE approaches achieve this by activating only subsets of a very large feed forward layer for each processed token (the alternative subsets of parameters are often called <em>experts</em>).</p>
<p>This technique comes at a cost, though: the operation of choosing the most suitable experts for a given token is discrete, and learning discrete choices is difficult; the models are known to suffer from issues including training instability and expert under- and overload. While some of those problems can be alleviated with e.g.&nbsp;the use of various auxiliary losses or reduced initialisation scale, it is certain that existing MoE techniques are more difficult and less intuitive to train than dense counterparts.</p>
<p>Aiming to avoid these problems we propose <strong>Mixture of Tokens</strong>: a new, fully-differentiable type of architecture that retains all efficiency benefits of MoE and alleviates the aformentioned problems by <em>mixing tokens</em> before feeding them into the feed-forward layer instead of routing tokens to experts, in effect allowing the model to simultaneously learn from all token-expert combinations. Crucially, this technique is fully compatible with both masked and causal LLM training.</p>
</section>
<section id="motivation" class="level1">
<h1>Motivation</h1>
<section id="scaling-language-models" class="level2">
<h2 class="anchored" data-anchor-id="scaling-language-models">Scaling Language Models</h2>
<p>Numerous <span class="SA">TODO SA poprawia</span> works <span class="citation" data-cites="kaplan2020scaling hoffmann2022training">(<a href="#ref-kaplan2020scaling" role="doc-biblioref">Kaplan et al. 2020</a>; <a href="#ref-hoffmann2022training" role="doc-biblioref">Hoffmann et al. 2022</a>)</span> have studied benefits of increasing the size of language models for their performance. However, this scaling comes at a very high computational cost <span class="citation" data-cites="strubell2019energy">(<a href="#ref-strubell2019energy" role="doc-biblioref">Strubell, Ganesh, and McCallum 2019</a>)</span>. Therefore, efficient use of computational resources and network parameters is often recognized as one of the most important challenges in the area <span class="SA">TODO moze lepsze słowo tutaj SA</span> <span class="citation" data-cites="rae2022scaling jaszczur2021sparse nawrot2022hierarchical">(<a href="#ref-rae2022scaling" role="doc-biblioref">Rae et al. 2022</a>; <a href="#ref-jaszczur2021sparse" role="doc-biblioref">Jaszczur et al. 2021</a>; <a href="#ref-nawrot2022hierarchical" role="doc-biblioref">Nawrot et al. 2022</a>)</span>. One of the most promising research directions in this domain is conditional computation, meaning methods that involve activating only a subset of parameters for a given input. In the context of language models, this idea has been most successfully implemented in MoE, leading to huge increases in model performance.</p>
</section>
<section id="mixture-of-experts" class="level2">
<h2 class="anchored" data-anchor-id="mixture-of-experts">Mixture of Experts</h2>
<p>The core idea in MoE is to increase model size without incurring additional computational costs. Roughly speaking, it is done by replacing the feed-forward layer standard for Transformer architectures with a (potentially very large) set of experts. In this new setup, a given token is processed only by a small subset of experts, and that selection is made by a small network called a <em>controller</em> (sometimes called a <em>router</em>). The change in model quality due to this increase in model size has been shown to behave predictably with respect to parameter count and inference compute <span class="citation" data-cites="clark2022unified">(<a href="#ref-clark2022unified" role="doc-biblioref">Clark et al. 2022</a>)</span>. More detailed background and explanation of variants of the MoE architecture is presented in <a href="#sec-back">Background</a>.</p>
</section>
<section id="limitations-of-current-approaches" class="level2">
<h2 class="anchored" data-anchor-id="limitations-of-current-approaches">Limitations of current approaches</h2>
<p>Despite promising results, wider adoption of MoE has been limited by a number of restrictions of the architecture and difficulties in the training. Among these, the most important are: <span class="SA">przeppisać ten paragraf</span></p>
<ul>
<li><strong>Training instability.</strong> Numerous works <span class="citation" data-cites="fedus2022switch du2022glam">(<a href="#ref-fedus2022switch" role="doc-biblioref">Fedus, Zoph, and Shazeer 2022</a>; <a href="#ref-du2022glam" role="doc-biblioref">Du et al. 2022</a>)</span> have reported difficulties in training MoE models due to instabilities. This is most likely connected with the discrete nature of the technique: the operation of choosing top-k most relevant tokens/experts in non-differentiable.We hypothesise that existing techniques used for training the cotnroller with gradient descent result in lower training stability.</li>
<li><strong>Load imbalance.</strong> Typically, in MoE we set the maximum <em>capacity</em> for each expert. However, we are not able to efficiently restrict the choice of the routing network to assign tokens in a perfectly balanced way. This leads to <em>token dropping</em> (when some tokens are not processed at all) and <em>expert under-training</em> (when some experts receive less data and are therefore not trained enough). <span class="SJ">mention underspecialization as well:</span> <span class="SA">there is work by Basil that does some balancing for that. Will liink later</span></li>
<li><strong>Information leak.</strong> Some of the most successful MoE methods process tokens from different positions in a sequence together (i.e.&nbsp;by comparing scores of all tokens in a batch). This imposes an information leak, and hinders their utility in autoregressive decoding. <span class="SA">remember that we leak in another way, so don’t be too harsh here, covering a large part of use cases in modern language models.</span> <span class="SJ">SJ edit, mention just industry applications</span><!--[SIMON ANOTHER LINK!!!!!!]--></li>
</ul>
<!-- We want to address these problems using our techique, Mixture of Tokens. -->
<!-- JK - tu można dorzucić nierówne traktowanie przykładów (niektóre przykłądy dostają więcej compute). Można też dać, ze niektóre techniki nie proponują rozwiązania, które byłoby użyteczne dla generative decoding, ale trzeba by dać related work powyżej -->
<!-- JK - byłoby bardziej logicze dać tę sekcję pod related work -->
<!--Without mentioning papers 
- obecne podejścia są niestabilne
- mamy idealny balancing token -> expert

with training stability, management of expert _load_ (how many tokens are routed to each expert) that lead to time overheads, mode collapse (all tokens routed to a small portion of the expert set), leaving some tokens unprocessed, problems with expert exploration and specialization/redundancy, low performance of discrete operations on accelerators and finally communication costs in parallel training.-->
</section>
</section>
<section id="sec-back" class="level1">
<h1>Background</h1>
<p>In the context of language models, Mixture of Experts has been originally proposed in <span class="citation" data-cites="shazeer2017outrageously">(<a href="#ref-shazeer2017outrageously" role="doc-biblioref">Shazeer et al. 2017</a>)</span>. Basic overview of the technique is presented in the diagram below: instead of processing each token with the standard feed-forward layer, we choose one of multiple possible experts.</p>
<p><span class="SJ">This section should be vastly improved</span></p>
<!-- {{< include diagrams/_generic_moe.qmd >}} -->
<p>The technique was further simplified by <span class="citation" data-cites="fedus2022switch">(<a href="#ref-fedus2022switch" role="doc-biblioref">Fedus, Zoph, and Shazeer 2022</a>)</span>, proposing to send each token to only <em>one</em> expert with the highest score produced by the routing network. In both cases there was a need to use auxiliary losses to encourage exploration and mitigate load imbalance across experts. More recently, <span class="citation" data-cites="zhou2022mixtureofexperts">(<a href="#ref-zhou2022mixtureofexperts" role="doc-biblioref">Zhou et al. 2022</a>)</span> proposed a different approach of choosing <em>Top-k tokens for each expert</em> instead. This means that different tokens might be attended to by varying number of experts. The difference between both approaches, <em>token choice</em> and <em>expert choice</em>, is illustrated in the diagram below.</p>
<div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;<mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2023-10-06T16:13:46.322Z\&quot; agent=\&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\&quot; etag=\&quot;jzo3oK75wbIPtteulHJ3\&quot; version=\&quot;22.0.3\&quot; type=\&quot;google\&quot;>\n  <diagram id=\&quot;77xPu9R-wu4rnPo6aUtL\&quot; name=\&quot;Page-4\&quot;>\n    <mxGraphModel dx=\&quot;1360\&quot; dy=\&quot;775\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;850\&quot; pageHeight=\&quot;1100\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;>\n      <root>\n        <mxCell id=\&quot;0\&quot; />\n        <mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; />\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-7\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;controller&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;179\&quot; y=\&quot;430\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-8\&quot; value=\&quot;\&quot; style=\&quot;endArrow=classic;html=1;rounded=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endSize=3;strokeColor=#4D4D4D;\&quot; parent=\&quot;1\&quot; source=\&quot;47trAblcvUlzrr_dalkz-1\&quot; target=\&quot;CCu9iRowCU_w_7v9His7-7\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;50\&quot; height=\&quot;50\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;209\&quot; y=\&quot;540\&quot; as=\&quot;sourcePoint\&quot; />\n            <mxPoint x=\&quot;-181\&quot; y=\&quot;320\&quot; as=\&quot;targetPoint\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-9\&quot; value=\&quot;\&quot; style=\&quot;endArrow=blockThin;dashed=1;html=1;dashPattern=1 3;strokeWidth=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endSize=4;endFill=0;strokeColor=#4D4D4D;\&quot; parent=\&quot;1\&quot; source=\&quot;CCu9iRowCU_w_7v9His7-7\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;50\&quot; height=\&quot;50\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;219\&quot; y=\&quot;490\&quot; as=\&quot;sourcePoint\&quot; />\n            <mxPoint x=\&quot;348.5\&quot; y=\&quot;390\&quot; as=\&quot;targetPoint\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-10\&quot; value=\&quot;\&quot; style=\&quot;endArrow=blockThin;dashed=1;html=1;dashPattern=1 3;strokeWidth=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endSize=4;endFill=0;strokeColor=#4D4D4D;\&quot; parent=\&quot;1\&quot; source=\&quot;CCu9iRowCU_w_7v9His7-7\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;50\&quot; height=\&quot;50\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;219\&quot; y=\&quot;490\&quot; as=\&quot;sourcePoint\&quot; />\n            <mxPoint x=\&quot;258.5\&quot; y=\&quot;390\&quot; as=\&quot;targetPoint\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-11\&quot; value=\&quot;\&quot; style=\&quot;endArrow=blockThin;dashed=1;html=1;dashPattern=1 3;strokeWidth=1;rounded=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endSize=4;endFill=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;strokeColor=#4D4D4D;\&quot; parent=\&quot;1\&quot; source=\&quot;CCu9iRowCU_w_7v9His7-7\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;50\&quot; height=\&quot;50\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;209\&quot; y=\&quot;480\&quot; as=\&quot;sourcePoint\&quot; />\n            <mxPoint x=\&quot;168.5\&quot; y=\&quot;390\&quot; as=\&quot;targetPoint\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-12\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot;&amp;gt;FFN1&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#000066;fontFamily=Helvetica;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;40\&quot; y=\&quot;350\&quot; width=\&quot;79\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-13\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot;&amp;gt;FFN2&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#000066;fontFamily=Helvetica;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;130\&quot; y=\&quot;350\&quot; width=\&quot;79\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-14\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot;&amp;gt;FFN3&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#000066;fontFamily=Helvetica;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;220\&quot; y=\&quot;350\&quot; width=\&quot;79\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-15\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot;&amp;gt;FFN4&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#000066;fontFamily=Helvetica;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;310\&quot; y=\&quot;350\&quot; width=\&quot;79\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-16\&quot; value=\&quot;\&quot; style=\&quot;endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=1;rounded=0;endSize=0;endFill=0;exitX=0.456;exitY=-0.079;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=1;entryDx=0;entryDy=0;startSize=0;strokeColor=#4D4D4D;\&quot; parent=\&quot;1\&quot; source=\&quot;CCu9iRowCU_w_7v9His7-15\&quot; target=\&quot;CCu9iRowCU_w_7v9His7-18\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;50\&quot; height=\&quot;50\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;270\&quot; y=\&quot;360\&quot; as=\&quot;sourcePoint\&quot; />\n            <mxPoint x=\&quot;269\&quot; y=\&quot;270\&quot; as=\&quot;targetPoint\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-17\&quot; value=\&quot;\&quot; style=\&quot;endArrow=blockThin;dashed=1;html=1;dashPattern=1 3;strokeWidth=1;rounded=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endSize=4;endFill=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;strokeColor=#4D4D4D;\&quot; parent=\&quot;1\&quot; source=\&quot;CCu9iRowCU_w_7v9His7-7\&quot; target=\&quot;CCu9iRowCU_w_7v9His7-12\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;50\&quot; height=\&quot;50\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;219\&quot; y=\&quot;490\&quot; as=\&quot;sourcePoint\&quot; />\n            <mxPoint x=\&quot;178.5\&quot; y=\&quot;400\&quot; as=\&quot;targetPoint\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-18\&quot; value=\&quot;\&quot; style=\&quot;ellipse;whiteSpace=wrap;html=1;aspect=fixed;strokeColor=#4D4D4D;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;207.5\&quot; y=\&quot;299\&quot; width=\&quot;3\&quot; height=\&quot;3\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-19\&quot; value=\&quot;\&quot; style=\&quot;endArrow=classic;html=1;rounded=0;startSize=3;endSize=3;strokeColor=#4D4D4D;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;CCu9iRowCU_w_7v9His7-18\&quot; target=\&quot;47trAblcvUlzrr_dalkz-28\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;50\&quot; height=\&quot;50\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;214.49999999999977\&quot; y=\&quot;270\&quot; as=\&quot;sourcePoint\&quot; />\n            <mxPoint x=\&quot;209.5\&quot; y=\&quot;260\&quot; as=\&quot;targetPoint\&quot; />\n            <Array as=\&quot;points\&quot;>\n              <mxPoint x=\&quot;209.5\&quot; y=\&quot;290\&quot; />\n            </Array>\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-20\&quot; value=\&quot;\&quot; style=\&quot;endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=1;rounded=0;endSize=0;endFill=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;strokeColor=#4D4D4D;\&quot; parent=\&quot;1\&quot; source=\&quot;CCu9iRowCU_w_7v9His7-14\&quot; target=\&quot;CCu9iRowCU_w_7v9His7-18\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;50\&quot; height=\&quot;50\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;356\&quot; y=\&quot;357\&quot; as=\&quot;sourcePoint\&quot; />\n            <mxPoint x=\&quot;247\&quot; y=\&quot;258\&quot; as=\&quot;targetPoint\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-21\&quot; value=\&quot;\&quot; style=\&quot;endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=1;rounded=0;endSize=0;endFill=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;strokeColor=#4D4D4D;\&quot; parent=\&quot;1\&quot; source=\&quot;CCu9iRowCU_w_7v9His7-13\&quot; target=\&quot;CCu9iRowCU_w_7v9His7-18\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;50\&quot; height=\&quot;50\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;270\&quot; y=\&quot;360\&quot; as=\&quot;sourcePoint\&quot; />\n            <mxPoint x=\&quot;233\&quot; y=\&quot;267\&quot; as=\&quot;targetPoint\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;CCu9iRowCU_w_7v9His7-22\&quot; value=\&quot;\&quot; style=\&quot;endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=1;rounded=0;endSize=0;endFill=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;strokeColor=#4D4D4D;\&quot; parent=\&quot;1\&quot; source=\&quot;CCu9iRowCU_w_7v9His7-12\&quot; target=\&quot;CCu9iRowCU_w_7v9His7-18\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;50\&quot; height=\&quot;50\&quot; relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;180\&quot; y=\&quot;360\&quot; as=\&quot;sourcePoint\&quot; />\n            <mxPoint x=\&quot;207\&quot; y=\&quot;268\&quot; as=\&quot;targetPoint\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-4\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;DKhqvwBs9N2eWBli3whP-1\&quot; target=\&quot;DKhqvwBs9N2eWBli3whP-7\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;DKhqvwBs9N2eWBli3whP-1\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;controller&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;564\&quot; y=\&quot;430\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-8\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;DKhqvwBs9N2eWBli3whP-7\&quot; target=\&quot;47trAblcvUlzrr_dalkz-6\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;DKhqvwBs9N2eWBli3whP-7\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot;&amp;gt;FFN2&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#000066;fontFamily=Helvetica;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;554.5\&quot; y=\&quot;350\&quot; width=\&quot;79\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-2\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;47trAblcvUlzrr_dalkz-1\&quot; target=\&quot;CCu9iRowCU_w_7v9His7-7\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-19\&quot; style=\&quot;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;shadow=0;dashed=1;\&quot; parent=\&quot;1\&quot; source=\&quot;47trAblcvUlzrr_dalkz-6\&quot; target=\&quot;47trAblcvUlzrr_dalkz-14\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-20\&quot; style=\&quot;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;shadow=0;dashed=1;\&quot; parent=\&quot;1\&quot; source=\&quot;47trAblcvUlzrr_dalkz-6\&quot; target=\&quot;47trAblcvUlzrr_dalkz-15\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-21\&quot; style=\&quot;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;shadow=0;dashed=1;\&quot; parent=\&quot;1\&quot; source=\&quot;47trAblcvUlzrr_dalkz-6\&quot; target=\&quot;47trAblcvUlzrr_dalkz-16\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-22\&quot; style=\&quot;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;shadow=0;dashed=1;\&quot; parent=\&quot;1\&quot; source=\&quot;47trAblcvUlzrr_dalkz-6\&quot; target=\&quot;47trAblcvUlzrr_dalkz-17\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-6\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;controller&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;564\&quot; y=\&quot;300\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-24\&quot; style=\&quot;edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;\&quot; parent=\&quot;1\&quot; source=\&quot;47trAblcvUlzrr_dalkz-9\&quot; target=\&quot;DKhqvwBs9N2eWBli3whP-1\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-9\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;459\&quot; y=\&quot;505\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-25\&quot; style=\&quot;edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;\&quot; parent=\&quot;1\&quot; source=\&quot;47trAblcvUlzrr_dalkz-10\&quot; target=\&quot;DKhqvwBs9N2eWBli3whP-1\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-10\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;529\&quot; y=\&quot;505\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-26\&quot; style=\&quot;edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;\&quot; parent=\&quot;1\&quot; source=\&quot;47trAblcvUlzrr_dalkz-11\&quot; target=\&quot;DKhqvwBs9N2eWBli3whP-1\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;610\&quot; y=\&quot;500\&quot; as=\&quot;targetPoint\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-11\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;598\&quot; y=\&quot;505\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-27\&quot; style=\&quot;edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;\&quot; parent=\&quot;1\&quot; source=\&quot;47trAblcvUlzrr_dalkz-12\&quot; target=\&quot;DKhqvwBs9N2eWBli3whP-1\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-12\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;669\&quot; y=\&quot;505\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-14\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;br&amp;gt;update&amp;lt;br&amp;gt;&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;459\&quot; y=\&quot;220\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-15\&quot; value=\&quot;token&amp;lt;br style=&amp;quot;border-color: var(--border-color); color: rgb(54, 54, 54);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(54, 54, 54);&amp;quot;&amp;gt;update&amp;lt;/span&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;529\&quot; y=\&quot;220\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-16\&quot; value=\&quot;token&amp;lt;br style=&amp;quot;border-color: var(--border-color); color: rgb(54, 54, 54);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(54, 54, 54);&amp;quot;&amp;gt;update&amp;lt;/span&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;599\&quot; y=\&quot;220\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-17\&quot; value=\&quot;token&amp;lt;br style=&amp;quot;border-color: var(--border-color); color: rgb(54, 54, 54);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(54, 54, 54);&amp;quot;&amp;gt;update&amp;lt;/span&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;669\&quot; y=\&quot;220\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-28\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;br&amp;gt;update&amp;lt;br&amp;gt;&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;179\&quot; y=\&quot;220\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-1\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;179\&quot; y=\&quot;505\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-30\&quot; value=\&quot;Token-choice\&quot; style=\&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;89\&quot; y=\&quot;520\&quot; width=\&quot;240\&quot; height=\&quot;90\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;47trAblcvUlzrr_dalkz-31\&quot; value=\&quot;Expert-choice\&quot; style=\&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;474\&quot; y=\&quot;520\&quot; width=\&quot;240\&quot; height=\&quot;90\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n      </root>\n    </mxGraphModel>\n  </diagram>\n</mxfile>\n&quot;}"></div>
<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
<p><span class="SJ">TODO SJ: dodac wykres vanilla/OG transformer</span></p>
<p><span class="SJ">TODO SJ poprawia</span></p>
<p>Concurrently to our work, <span class="citation" data-cites="puigcerver2023sparse">(<a href="#ref-puigcerver2023sparse" role="doc-biblioref">Puigcerver et al. 2023</a>)</span> proposed a continuous variant of Mixture of Experts for the Vision Transformer, as such limited to encoder-only models. Another approach allowing to avoid discrete operations in MoE by merging experts was presented in <span class="citation" data-cites="muqeeth2023soft">(<a href="#ref-muqeeth2023soft" role="doc-biblioref">Muqeeth, Liu, and Raffel 2023</a>)</span>.</p>
<!-- JK- czy były inne soft wersje moe? -->
<!-- [This needs to be quite comprehensive, what we see below unnecessarily focuses on Expert Choice and Softmoe]{.SA}
In recent years, there has been a growing interest in methods of increasing the number of parameters in neural networks while maintaining their computational demands. A major advance in eliminating some problems with traditional MoE approaches is Expert Choice (here biblio). Our work has been inspired by their approach - Mixture of Tokens can be seen as an Expert Choice (as opposed to *Token Choice*) kind of method.

There is also concurrent work (Softmoe) nvestigating ideas similar to ours in the vision domain. It is, however, limited to encoder-only models. It is worth noting that earlier, other fully-differentiable MoE approaches had been proposed (biblio copied from Softmoe). /* jakoś inaczej sformułowac: However, expert-mixing strategies presented in those works incur significant computational overhead. Also, they are token choice instead of expert choice, so different than us. */ -->
</section>
<section id="method" class="level1">
<h1>Method</h1>
<!-- In this section we provide an overview of our proposed method. More detailed description of all operations can be found in the next section. [T U T A J L I N K]{.SA} -->
<p><span class="SJ">Link to diagrams: https://drive.google.com/file/d/1jvew0ft43zpaG-iCk7Ob2ilJw7VjsyeZ/view?usp=sharing</span> <!-- 
[Move this paragraph to background]{.SJ}
The general idea of Mixture of Tokens is to run multiple experts which independently aggregate and process tokens. The most common (and original) form of MoE, token-choice, operates from the perspective of a single token. [This paragraph will be more detailed in background section.]{.SJ} However, Mixture of Tokens is more similar to expert-choice, where it is an expert who decides which tokens to process.

[comparison of both token-choice and expert-choice]{.SJ}

{{< include diagrams/_vanillamoes.qmd >}}  --></p>
<p>In Mixture of Tokens, all experts work independently from one another and act similar to a normal feed-forward layer. The difference in our setup, compared to MoE, is that a single expert receives a weighted average of multiple tokens. Then, output from an expert is rescaled and redistributed to the original tokens. See the diagrams below. <span class="SA">SA stylistycznie</span></p>
<div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;<mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2023-10-06T16:00:11.975Z\&quot; agent=\&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\&quot; etag=\&quot;thLgguIcNBL9zn-3R11T\&quot; version=\&quot;22.0.3\&quot; type=\&quot;google\&quot;>\n  <diagram id=\&quot;abJAIyk8VqZmFR_1QRqh\&quot; name=\&quot;Page-2\&quot;>\n    <mxGraphModel dx=\&quot;816\&quot; dy=\&quot;768\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;850\&quot; pageHeight=\&quot;1100\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;>\n      <root>\n        <mxCell id=\&quot;0\&quot; />\n        <mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; />\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-1\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-2\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-12\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-2\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;merger&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;415\&quot; y=\&quot;620\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-3\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;shadow=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-4\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-2\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-4\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;538\&quot; y=\&quot;690\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-5\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-6\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-2\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;600\&quot; y=\&quot;640\&quot; as=\&quot;targetPoint\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-6\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;456\&quot; y=\&quot;690\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-7\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-8\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-2\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-8\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;375\&quot; y=\&quot;690\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-9\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-10\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-2\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-10\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;290\&quot; y=\&quot;690\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-11\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-12\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-14\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-12\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;merged &amp;lt;br&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;415\&quot; y=\&quot;560\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-13\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-14\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-16\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-14\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot;&amp;gt;FFN1&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#000066;fontFamily=Helvetica;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;405.5\&quot; y=\&quot;490\&quot; width=\&quot;79\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-15\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-16\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-21\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-16\&quot; value=\&quot;output\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;415\&quot; y=\&quot;430\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-17\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-21\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-24\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-18\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-21\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-25\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-19\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-21\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-23\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-20\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-21\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-22\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-21\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;emitter&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;415\&quot; y=\&quot;370\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-22\&quot; value=\&quot;scaled output\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;538\&quot; y=\&quot;300\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-23\&quot; value=\&quot;scaled output\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;456\&quot; y=\&quot;300\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-24\&quot; value=\&quot;scaled output\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;375\&quot; y=\&quot;300\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-25\&quot; value=\&quot;scaled output\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;290\&quot; y=\&quot;300\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n      </root>\n    </mxGraphModel>\n  </diagram>\n</mxfile>\n&quot;}"></div>
<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
<div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;<mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2023-10-06T16:07:20.467Z\&quot; agent=\&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\&quot; etag=\&quot;AkvXUQBoiw4g7UOkN9YG\&quot; version=\&quot;22.0.3\&quot;>\n  <diagram name=\&quot;Page-1\&quot; id=\&quot;vzWX_hfrwb7zkzXL2RKS\&quot;>\n    <mxGraphModel dx=\&quot;1360\&quot; dy=\&quot;775\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;850\&quot; pageHeight=\&quot;1100\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;>\n      <root>\n        <mxCell id=\&quot;0\&quot; />\n        <mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; />\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-1\&quot; value=\&quot;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;105\&quot; y=\&quot;370\&quot; width=\&quot;890\&quot; height=\&quot;380\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-22\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;tQRlU9-GiwyWhz3ECh0B-2\&quot; target=\&quot;tQRlU9-GiwyWhz3ECh0B-13\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-2\&quot; value=\&quot;merged token\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;390\&quot; y=\&quot;800\&quot; width=\&quot;320\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-25\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;tQRlU9-GiwyWhz3ECh0B-13\&quot; target=\&quot;tQRlU9-GiwyWhz3ECh0B-15\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-13\&quot; value=\&quot;linear layer 1\&quot; style=\&quot;shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;html=1;fixedSize=1;rotation=0;fillColor=#e1d5e7;strokeColor=#9673a6;flipV=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;360\&quot; y=\&quot;650\&quot; width=\&quot;380\&quot; height=\&quot;60\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-26\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;tQRlU9-GiwyWhz3ECh0B-15\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;550\&quot; y=\&quot;520\&quot; as=\&quot;targetPoint\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-15\&quot; value=\&quot;hidden state\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;355\&quot; y=\&quot;580\&quot; width=\&quot;390\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-8\&quot; value=\&quot;ReLU\&quot; style=\&quot;ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;535\&quot; y=\&quot;535\&quot; width=\&quot;30\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-30\&quot; value=\&quot;&amp;lt;b&amp;gt;&amp;lt;font style=&amp;quot;font-size: 36px;&amp;quot;&amp;gt;FFN1&amp;lt;/font&amp;gt;&amp;lt;/b&amp;gt;\&quot; style=\&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#000066;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;680\&quot; y=\&quot;620\&quot; width=\&quot;400\&quot; height=\&quot;210\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-39\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;tQRlU9-GiwyWhz3ECh0B-33\&quot; target=\&quot;tQRlU9-GiwyWhz3ECh0B-34\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-33\&quot; value=\&quot;hidden state\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;355\&quot; y=\&quot;470\&quot; width=\&quot;390\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-37\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;tQRlU9-GiwyWhz3ECh0B-34\&quot; target=\&quot;tQRlU9-GiwyWhz3ECh0B-35\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-34\&quot; value=\&quot;\&quot; style=\&quot;shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;html=1;fixedSize=1;rotation=-180;fillColor=#e1d5e7;strokeColor=#9673a6;flipV=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;360\&quot; y=\&quot;385\&quot; width=\&quot;380\&quot; height=\&quot;60\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-31\&quot; value=\&quot;linear layer 2&amp;lt;br&amp;gt;\&quot; style=\&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;490\&quot; y=\&quot;400\&quot; width=\&quot;120\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;tQRlU9-GiwyWhz3ECh0B-35\&quot; value=\&quot;expert output\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;390\&quot; y=\&quot;270\&quot; width=\&quot;320\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n      </root>\n    </mxGraphModel>\n  </diagram>\n</mxfile>\n&quot;}"></div>
<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
<p>Weights for merging and emitting groups of tokens are calculated using <em>controller</em> and <em>softmax</em>.</p>

<div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;<mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2023-10-06T16:14:49.567Z\&quot; agent=\&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\&quot; etag=\&quot;UvRhxeiE3kUv6kb9InzY\&quot; version=\&quot;22.0.3\&quot; type=\&quot;google\&quot;>\n  <diagram id=\&quot;C2AunCsj_dl_T9ErqCql\&quot; name=\&quot;Page-3\&quot;>\n    <mxGraphModel dx=\&quot;1360\&quot; dy=\&quot;775\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;850\&quot; pageHeight=\&quot;1100\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;>\n      <root>\n        <mxCell id=\&quot;0\&quot; />\n        <mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; />\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-1\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;rHSgD5Xiz5xGRAaISVyj-2\&quot; target=\&quot;rHSgD5Xiz5xGRAaISVyj-12\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-2\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;merger:&amp;lt;br&amp;gt;multiplication&amp;lt;br&amp;gt;(reduce-sum)&amp;lt;br&amp;gt;&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;267.5\&quot; y=\&quot;610\&quot; width=\&quot;75\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-11\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;rHSgD5Xiz5xGRAaISVyj-12\&quot; target=\&quot;rHSgD5Xiz5xGRAaISVyj-14\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-12\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;merged &amp;lt;br&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;275\&quot; y=\&quot;550\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-13\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;rHSgD5Xiz5xGRAaISVyj-14\&quot; target=\&quot;rHSgD5Xiz5xGRAaISVyj-16\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-14\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot;&amp;gt;FFN1&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#000066;fontFamily=Helvetica;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;265.5\&quot; y=\&quot;480\&quot; width=\&quot;79\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-15\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;rHSgD5Xiz5xGRAaISVyj-16\&quot; target=\&quot;rHSgD5Xiz5xGRAaISVyj-21\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-16\&quot; value=\&quot;output\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;275\&quot; y=\&quot;420\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-59\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;curved=1;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;rHSgD5Xiz5xGRAaISVyj-21\&quot; target=\&quot;rHSgD5Xiz5xGRAaISVyj-52\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-21\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;emitter:&amp;lt;br&amp;gt;multiplication (expand)&amp;lt;br&amp;gt;&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;267.5\&quot; y=\&quot;340\&quot; width=\&quot;75\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-49\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;curved=1;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;rHSgD5Xiz5xGRAaISVyj-26\&quot; target=\&quot;rHSgD5Xiz5xGRAaISVyj-47\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;>\n            <mxPoint x=\&quot;560\&quot; y=\&quot;760\&quot; as=\&quot;targetPoint\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-51\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;curved=1;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;rHSgD5Xiz5xGRAaISVyj-26\&quot; target=\&quot;rHSgD5Xiz5xGRAaISVyj-2\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-26\&quot; value=\&quot;\&quot; style=\&quot;shape=table;startSize=0;container=1;collapsible=0;childLayout=tableLayout;fontSize=16;rounded=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;320\&quot; y=\&quot;830\&quot; width=\&quot;245\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-27\&quot; value=\&quot;\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;rounded=1;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-26\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;245\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-39\&quot; value=\&quot;emb1\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=#82b366;overflow=hidden;fillColor=#d5e8d4;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;rounded=1;perimeterSpacing=7;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-27\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;62\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;>\n            <mxRectangle width=\&quot;62\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-28\&quot; value=\&quot;emb2\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=#82b366;overflow=hidden;fillColor=#d5e8d4;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;rounded=1;perimeterSpacing=7;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-27\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;62\&quot; width=\&quot;61\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;>\n            <mxRectangle width=\&quot;61\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-29\&quot; value=\&quot;emb3\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=#82b366;overflow=hidden;fillColor=#d5e8d4;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;rounded=1;perimeterSpacing=7;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-27\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;123\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;>\n            <mxRectangle width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-30\&quot; value=\&quot;emb4\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=#82b366;overflow=hidden;fillColor=#d5e8d4;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;rounded=1;perimeterSpacing=7;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-27\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;183\&quot; width=\&quot;62\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;>\n            <mxRectangle width=\&quot;62\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-50\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;curved=1;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;rHSgD5Xiz5xGRAaISVyj-40\&quot; target=\&quot;rHSgD5Xiz5xGRAaISVyj-2\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-58\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;curved=1;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;rHSgD5Xiz5xGRAaISVyj-40\&quot; target=\&quot;rHSgD5Xiz5xGRAaISVyj-21\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-40\&quot; value=\&quot;\&quot; style=\&quot;shape=table;startSize=0;container=1;collapsible=0;childLayout=tableLayout;fontSize=16;rounded=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;425\&quot; y=\&quot;660\&quot; width=\&quot;245\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-41\&quot; value=\&quot;\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;rounded=1;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-40\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;245\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-42\&quot; value=\&quot;w1\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=#82b366;overflow=hidden;fillColor=#d5e8d4;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;rounded=1;perimeterSpacing=7;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-41\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;62\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;>\n            <mxRectangle width=\&quot;62\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-43\&quot; value=\&quot;w2\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=#82b366;overflow=hidden;fillColor=#d5e8d4;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;rounded=1;perimeterSpacing=7;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-41\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;62\&quot; width=\&quot;61\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;>\n            <mxRectangle width=\&quot;61\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-44\&quot; value=\&quot;w3\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=#82b366;overflow=hidden;fillColor=#d5e8d4;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;rounded=1;perimeterSpacing=7;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-41\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;123\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;>\n            <mxRectangle width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-45\&quot; value=\&quot;w4\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=#82b366;overflow=hidden;fillColor=#d5e8d4;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;rounded=1;perimeterSpacing=7;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-41\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;183\&quot; width=\&quot;62\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;>\n            <mxRectangle width=\&quot;62\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-48\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;curved=1;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;rHSgD5Xiz5xGRAaISVyj-47\&quot; target=\&quot;HxM0d9VlpgWr96RrhKD8-1\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-47\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot;&amp;gt;controller&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;517.5\&quot; y=\&quot;760\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-52\&quot; value=\&quot;\&quot; style=\&quot;shape=table;startSize=0;container=1;collapsible=0;childLayout=tableLayout;fontSize=16;rounded=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;182.5\&quot; y=\&quot;260\&quot; width=\&quot;245\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-53\&quot; value=\&quot;\&quot; style=\&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;rounded=1;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-52\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;245\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-54\&quot; value=\&quot;emb1\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=#82b366;overflow=hidden;fillColor=#d5e8d4;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;rounded=1;perimeterSpacing=7;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-53\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry width=\&quot;62\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;>\n            <mxRectangle width=\&quot;62\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-55\&quot; value=\&quot;emb2\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=#82b366;overflow=hidden;fillColor=#d5e8d4;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;rounded=1;perimeterSpacing=7;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-53\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;62\&quot; width=\&quot;61\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;>\n            <mxRectangle width=\&quot;61\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-56\&quot; value=\&quot;emb3\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=#82b366;overflow=hidden;fillColor=#d5e8d4;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;rounded=1;perimeterSpacing=7;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-53\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;123\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;>\n            <mxRectangle width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;rHSgD5Xiz5xGRAaISVyj-57\&quot; value=\&quot;emb4\&quot; style=\&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=#82b366;overflow=hidden;fillColor=#d5e8d4;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;rounded=1;perimeterSpacing=7;\&quot; parent=\&quot;rHSgD5Xiz5xGRAaISVyj-53\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;183\&quot; width=\&quot;62\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot;>\n            <mxRectangle width=\&quot;62\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; />\n          </mxGeometry>\n        </mxCell>\n        <mxCell id=\&quot;HxM0d9VlpgWr96RrhKD8-2\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;HxM0d9VlpgWr96RrhKD8-1\&quot; target=\&quot;rHSgD5Xiz5xGRAaISVyj-40\&quot; edge=\&quot;1\&quot;>\n          <mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;HxM0d9VlpgWr96RrhKD8-1\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot;&amp;gt;softmax&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;517.5\&quot; y=\&quot;710\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n      </root>\n    </mxGraphModel>\n  </diagram>\n</mxfile>\n&quot;}"></div>
<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>

<p>There are multiple possible ways to group tokens. However, to be able to use Mixture of Tokens in autoregressive decoder we group tokens by position as presented in the diagram below.</p>
<div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;<mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2023-10-06T16:15:50.208Z\&quot; agent=\&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\&quot; etag=\&quot;gr3hoMf3V8pFhms6YLmy\&quot; version=\&quot;22.0.3\&quot; type=\&quot;google\&quot;>\n  <diagram id=\&quot;fbuRVmtAR91k7QgiWp5u\&quot; name=\&quot;Page-5\&quot;>\n    <mxGraphModel dx=\&quot;1360\&quot; dy=\&quot;775\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;850\&quot; pageHeight=\&quot;1100\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;>\n      <root>\n        <mxCell id=\&quot;0\&quot; />\n        <mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; />\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-1\&quot; value=\&quot;If\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;180\&quot; y=\&quot;330\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-2\&quot; value=\&quot;music\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;240\&quot; y=\&quot;330\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-3\&quot; value=\&quot;be\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;300\&quot; y=\&quot;330\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-4\&quot; value=\&quot;the\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;360\&quot; y=\&quot;330\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-5\&quot; value=\&quot;food\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;420\&quot; y=\&quot;330\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-8\&quot; value=\&quot;Attention\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;180\&quot; y=\&quot;360\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-9\&quot; value=\&quot;Is\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;240\&quot; y=\&quot;360\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-10\&quot; value=\&quot;All\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;300\&quot; y=\&quot;360\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-11\&quot; value=\&quot;You\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;360\&quot; y=\&quot;360\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-12\&quot; value=\&quot;Need\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;420\&quot; y=\&quot;360\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-14\&quot; value=\&quot;arXiv\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;180\&quot; y=\&quot;390\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-15\&quot; value=\&quot;is\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;240\&quot; y=\&quot;390\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-16\&quot; value=\&quot;a\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;300\&quot; y=\&quot;390\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-17\&quot; value=\&quot;free\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;360\&quot; y=\&quot;390\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-18\&quot; value=\&quot;distribution\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;420\&quot; y=\&quot;390\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-20\&quot; value=\&quot;Warsaw\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;180\&quot; y=\&quot;420\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-21\&quot; value=\&quot;,\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;240\&quot; y=\&quot;420\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-22\&quot; value=\&quot;officially\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;300\&quot; y=\&quot;420\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-23\&quot; value=\&quot;the\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;360\&quot; y=\&quot;420\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;0gGov9fe-cEn-tlOC79J-24\&quot; value=\&quot;Capital\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;420\&quot; y=\&quot;420\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-1\&quot; value=\&quot;\&quot; style=\&quot;html=1;shadow=0;dashed=0;align=center;verticalAlign=middle;shape=mxgraph.arrows2.arrow;dy=0.6;dx=40;direction=south;notch=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;295\&quot; y=\&quot;450\&quot; width=\&quot;70\&quot; height=\&quot;60\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-2\&quot; value=\&quot;If\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;130\&quot; y=\&quot;530\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-3\&quot; value=\&quot;music\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;220\&quot; y=\&quot;530\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-4\&quot; value=\&quot;be\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;310\&quot; y=\&quot;530\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-5\&quot; value=\&quot;the\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;400\&quot; y=\&quot;530\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-6\&quot; value=\&quot;food\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;490\&quot; y=\&quot;530\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-7\&quot; value=\&quot;Attention\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;130\&quot; y=\&quot;550\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-8\&quot; value=\&quot;Is\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;220\&quot; y=\&quot;550\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-9\&quot; value=\&quot;All\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;310\&quot; y=\&quot;550\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-10\&quot; value=\&quot;You\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;400\&quot; y=\&quot;550\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-11\&quot; value=\&quot;Need\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;490\&quot; y=\&quot;550\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-12\&quot; value=\&quot;arXiv\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;130\&quot; y=\&quot;570\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-13\&quot; value=\&quot;is\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;220\&quot; y=\&quot;570\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-14\&quot; value=\&quot;a\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;310\&quot; y=\&quot;570\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-15\&quot; value=\&quot;free\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;400\&quot; y=\&quot;570\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-16\&quot; value=\&quot;distribution\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;490\&quot; y=\&quot;570\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-17\&quot; value=\&quot;Warsaw\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;130\&quot; y=\&quot;590\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-18\&quot; value=\&quot;,\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;220\&quot; y=\&quot;590\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-19\&quot; value=\&quot;officially\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;310\&quot; y=\&quot;590\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-20\&quot; value=\&quot;the\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;400\&quot; y=\&quot;590\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-21\&quot; value=\&quot;Capital\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;490\&quot; y=\&quot;590\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-24\&quot; value=\&quot;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeWidth=2;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;120\&quot; y=\&quot;520\&quot; width=\&quot;80\&quot; height=\&quot;100\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-25\&quot; value=\&quot;group #1\&quot; style=\&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;130\&quot; y=\&quot;620\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-26\&quot; value=\&quot;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeWidth=2;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;210\&quot; y=\&quot;520\&quot; width=\&quot;80\&quot; height=\&quot;100\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-27\&quot; value=\&quot;group #2\&quot; style=\&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;220\&quot; y=\&quot;620\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-30\&quot; value=\&quot;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeWidth=2;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;300\&quot; y=\&quot;520\&quot; width=\&quot;80\&quot; height=\&quot;100\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-31\&quot; value=\&quot;group #3\&quot; style=\&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;310\&quot; y=\&quot;620\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-32\&quot; value=\&quot;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeWidth=2;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;390\&quot; y=\&quot;520\&quot; width=\&quot;80\&quot; height=\&quot;100\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-33\&quot; value=\&quot;group #4\&quot; style=\&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;400\&quot; y=\&quot;620\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-34\&quot; value=\&quot;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeWidth=2;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;480\&quot; y=\&quot;520\&quot; width=\&quot;80\&quot; height=\&quot;100\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n        <mxCell id=\&quot;f1csoL0ObmmRQoyrzgdK-35\&quot; value=\&quot;group #5\&quot; style=\&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;>\n          <mxGeometry x=\&quot;490\&quot; y=\&quot;620\&quot; width=\&quot;60\&quot; height=\&quot;20\&quot; as=\&quot;geometry\&quot; />\n        </mxCell>\n      </root>\n    </mxGraphModel>\n  </diagram>\n</mxfile>\n&quot;}"></div>
<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
<!-- In Mixture of Tokens, each expert works independently from one another. [The only dependence is during experts' outputs aggregation, but it's a matter of rescaling each output before adding it to the residual, so we will skip it/explain it in later section.]{.SJ} Therefore, to explain the inner workings of Mixture of Tokens we will focus on a single expert. See the diagram below.



```{=html}
<div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2023-10-06T16:00:11.975Z\&quot; agent=\&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\&quot; etag=\&quot;thLgguIcNBL9zn-3R11T\&quot; version=\&quot;22.0.3\&quot; type=\&quot;google\&quot;&gt;\n  &lt;diagram id=\&quot;abJAIyk8VqZmFR_1QRqh\&quot; name=\&quot;Page-2\&quot;&gt;\n    &lt;mxGraphModel dx=\&quot;816\&quot; dy=\&quot;768\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;850\&quot; pageHeight=\&quot;1100\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;&gt;\n      &lt;root&gt;\n        &lt;mxCell id=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-1\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-2\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-12\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-2\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;merger&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;415\&quot; y=\&quot;620\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-3\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;shadow=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-4\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-2\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-4\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;538\&quot; y=\&quot;690\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-5\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-6\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-2\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;600\&quot; y=\&quot;640\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-6\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;456\&quot; y=\&quot;690\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-7\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-8\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-2\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-8\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;375\&quot; y=\&quot;690\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-9\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-10\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-2\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-10\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;290\&quot; y=\&quot;690\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-11\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-12\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-14\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-12\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;merged &amp;lt;br&amp;gt;token&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;415\&quot; y=\&quot;560\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-13\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-14\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-16\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-14\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot;&amp;gt;FFN1&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#000066;fontFamily=Helvetica;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;405.5\&quot; y=\&quot;490\&quot; width=\&quot;79\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-15\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-16\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-21\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-16\&quot; value=\&quot;output\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;415\&quot; y=\&quot;430\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-17\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-21\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-24\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-18\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-21\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-25\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-19\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-21\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-23\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-20\&quot; style=\&quot;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;Thd8qZe_ERqzthlJM7T2-21\&quot; target=\&quot;Thd8qZe_ERqzthlJM7T2-22\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-21\&quot; value=\&quot;&amp;lt;font color=&amp;quot;#363636&amp;quot; style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;emitter&amp;lt;/font&amp;gt;\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;415\&quot; y=\&quot;370\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-22\&quot; value=\&quot;scaled output\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;538\&quot; y=\&quot;300\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-23\&quot; value=\&quot;scaled output\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;456\&quot; y=\&quot;300\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-24\&quot; value=\&quot;scaled output\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;375\&quot; y=\&quot;300\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Thd8qZe_ERqzthlJM7T2-25\&quot; value=\&quot;scaled output\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;glass=0;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;290\&quot; y=\&quot;300\&quot; width=\&quot;60\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n      &lt;/root&gt;\n    &lt;/mxGraphModel&gt;\n  &lt;/diagram&gt;\n&lt;/mxfile&gt;\n&quot;}"></div>
<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
```





This single expert works as a normal feedforward layer[(maybe a diagram of lin1->relu->lin2?)]{.SJ}, except for a merger and an emitter placed to process the input and the output, respectively. Each merger takes a group of tokens and computes a weighted average of them ~~(according to weights described in later section)~~. 



~~Now we get to the part of computing weights.~~
 The weights are the same [(are they really?)]{.SJ}[It depends on a version]{.MK} for both merger and emitter.



How can we apply this technique in decoder? We need a kind of grouping that will not leak information into future tokens. We can achieve that by grouping tokens by position.



{{< include diagrams/_grouping.qmd >}} -->

<!-- ## Implementation
In the first phase of our Mixture of Tokens Layer, we partition batch sequences into token gropus of equal size. 
Then for each group, we calculate a two sets of weights, named _merge_ and _emit_. Each set of weights sum to 1.0, signifying the percentage of each token to utilize.

For every group, using its _merge_ weights, we merge belonging tokens into a single token. Following this, we process all merged tokens with linear experts' weights and a relu activation function. [Komentarz: To zdecydowanie trzeba lepiej napisać]{.MK} 
Employing _emit_ weights, we redistribute resultant token after the experts' layer back to a group of tokens. Lastly, we join the groups to align with the Feed Forward layer input dimensions.

## Encoder vs Decoder
In encoder-only models,   ach token may attend to the whole input sequence, whereas decoder-only models only allow attending to the tokens that came before a particular token to simulate the autoregressive decoding used during model inference. This is crucial for the training of decoder-only models, as allowing a token to attend to future tokens would constitute a data leak, preventing successful training.
A major problem potentially facing any token-mixing strategy is the possibility of a data leak, making the strategy inappropriate for use with decoder-only models. In Mixture of Tokens, the tokens are mixed across batch, i.e. with other tokens at the same position in other samples in the same training batch. We don't consider other strategies which would be more suitable in the context of encoders. -->
</section>
<section id="experiments" class="level1">
<h1>Experiments</h1>
<section id="experimental-setup" class="level2">
<h2 class="anchored" data-anchor-id="experimental-setup">Experimental setup</h2>
<p>For the baseline, we train a standard GPT-like model on the language modeling task using cross entropy loss on the C4 dataset <span class="citation" data-cites="2019t5">(<a href="#ref-2019t5" role="doc-biblioref">Raffel et al. 2019</a>)</span>. Our model replaces all feed-forward layers with MoT layers.</p>
<p>For proof-of-concept experiments, we chose model size identical to <strong>BERT-mini</strong>:</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Model Hyperparameters
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>4 layers</li>
<li>256 embedding dimension</li>
<li>1024 hidden dimension</li>
<li>4 attention heads</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Training Setup
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>250K training steps</li>
<li>256 context length</li>
<li>256 batch size</li>
<li>lr warmup for the first 1% of training</li>
<li>cosine scheduling to 0.1 of peak lr at the end of training</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mixture of Tokens hyperparameters
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>32 group size</li>
<li>512 experts</li>
<li>32x more parameters than a dense feed-forward layer</li>
</ul>
</div>
</div>
<p>The learning rate was tuned separately for both our model and the baseline:</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Rate
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Dense baseline: 4e-3</li>
<li>Mixture of Tokens: 2e-3</li>
</ul>
</div>
</div>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>


<meta charset="utf-8">

    <div>                            <div id="ebb8518a-6b15-4cdd-9039-a1f5a9ca3337" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("ebb8518a-6b15-4cdd-9039-a1f5a9ca3337")) {                    Plotly.newPlot(                        "ebb8518a-6b15-4cdd-9039-a1f5a9ca3337",                        [{"name":"Baseline","x":[1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0,9000.0,10000.0,11000.0,12000.0,13000.0,14000.0,15000.0,16000.0,17000.0,18000.0,19000.0,20000.0,21000.0,22000.0,23000.0,24000.0,25000.0,26000.0,27000.0,28000.0,29000.0,30000.0,31000.0,32000.0,33000.0,34000.0,35000.0,36000.0,37000.0,38000.0,39000.0,40000.0,41000.0,42000.0,43000.0,44000.0,45000.0,46000.0,47000.0,48000.0,49000.0,50000.0,51000.0,52000.0,53000.0,54000.0,55000.0,56000.0,57000.0,58000.0,59000.0,60000.0,61000.0,62000.0,63000.0,64000.0,65000.0,66000.0,67000.0,68000.0,69000.0,70000.0,71000.0,72000.0,73000.0,74000.0,75000.0,76000.0,77000.0,78000.0,79000.0,80000.0,81000.0,82000.0,83000.0,84000.0,85000.0,86000.0,87000.0,88000.0,89000.0,90000.0,91000.0,92000.0,93000.0,94000.0,95000.0,96000.0,97000.0,98000.0,99000.0,100000.0,101000.0,102000.0,103000.0,104000.0,105000.0,106000.0,107000.0,108000.0,109000.0,110000.0,111000.0,112000.0,113000.0,114000.0,115000.0,116000.0,117000.0,118000.0,119000.0,120000.0,121000.0,122000.0,123000.0,124000.0,125000.0,126000.0,127000.0,128000.0,129000.0,130000.0,131000.0,132000.0,133000.0,134000.0,135000.0,136000.0,137000.0,138000.0,139000.0,140000.0,141000.0,142000.0,143000.0,144000.0,145000.0,146000.0,147000.0,148000.0,149000.0,150000.0,151000.0,152000.0,153000.0,154000.0,155000.0,156000.0,157000.0,158000.0,159000.0,160000.0,161000.0,162000.0,163000.0,164000.0,165000.0,166000.0,167000.0,168000.0,169000.0,170000.0,171000.0,172000.0,173000.0,174000.0,175000.0,176000.0,177000.0,178000.0,179000.0,180000.0,181000.0,182000.0,183000.0,184000.0,185000.0,186000.0,187000.0,188000.0,189000.0,190000.0,191000.0,192000.0,193000.0,194000.0,195000.0,196000.0,197000.0,198000.0,199000.0,200000.0,201000.0,202000.0,203000.0,204000.0,205000.0,206000.0,207000.0,208000.0,209000.0,210000.0,211000.0,212000.0,213000.0,214000.0,215000.0,216000.0,217000.0,218000.0,219000.0,220000.0,221000.0,222000.0,223000.0,224000.0,225000.0,226000.0,227000.0,228000.0,229000.0,230000.0,231000.0,232000.0,233000.0,234000.0,235000.0,236000.0,237000.0,238000.0,239000.0,240000.0,241000.0,242000.0,243000.0,244000.0,245000.0,246000.0,247000.0,248000.0,249000.0,250000.0],"y":[6.74839453125,5.4187265625,4.9736796875,4.735296875,4.630875,4.56698828125,4.519,4.4851484375,4.45952734375,4.43978515625,4.42198828125,4.4113125,4.39663671875,4.38164453125,4.37398046875,4.363734375,4.3577890625,4.34557421875,4.3384140625,4.32876171875,4.3243203125,4.319109375,4.3143203125,4.30580078125,4.2994453125,4.2956015625,4.292625,4.28841796875,4.28327734375,4.2778046875,4.277015625,4.272265625,4.2683046875,4.2671953125,4.262171875,4.26112109375,4.258078125,4.25455859375,4.25040625,4.24560546875,4.2448046875,4.24388671875,4.243,4.237890625,4.235296875,4.23173046875,4.2287109375,4.22712109375,4.22437109375,4.22453125,4.2206796875,4.21865625,4.21700390625,4.2149140625,4.21329296875,4.21173828125,4.20691015625,4.20617578125,4.20566015625,4.2051171875,4.199109375,4.20054296875,4.19573046875,4.19511328125,4.19466015625,4.1915859375,4.190609375,4.18851171875,4.18603125,4.1866171875,4.1823828125,4.1841171875,4.17944140625,4.18012890625,4.17614453125,4.17441015625,4.1732734375,4.171921875,4.1710234375,4.16890625,4.16660546875,4.1675703125,4.16252734375,4.161875,4.16170703125,4.159328125,4.15687890625,4.15765625,4.1536953125,4.15349609375,4.151734375,4.15009765625,4.15083203125,4.1477578125,4.14693359375,4.14521484375,4.14371875,4.140640625,4.1391875,4.1400859375,4.13821875,4.136171875,4.1346953125,4.13290234375,4.13382421875,4.1321171875,4.127845703125,4.12960546875,4.1271328125,4.124853515625,4.126546875,4.12116015625,4.118875,4.1194375,4.11716796875,4.117326171875,4.11452734375,4.11478515625,4.11265625,4.1118515625,4.110716796875,4.10695703125,4.105974609375,4.1069453125,4.1039609375,4.104115234375,4.10241796875,4.10298046875,4.100599609375,4.09512890625,4.09860546875,4.094466796875,4.09503515625,4.093646484375,4.08973828125,4.09240234375,4.09222265625,4.088080078125,4.08678515625,4.085791015625,4.082439453125,4.082064453125,4.08147265625,4.080451171875,4.08063671875,4.07994921875,4.07630078125,4.07576953125,4.074875,4.07455078125,4.073796875,4.071392578125,4.072060546875,4.06762890625,4.066365234375,4.0654765625,4.064796875,4.06455078125,4.0633359375,4.061970703125,4.060384765625,4.0594140625,4.059236328125,4.057814453125,4.056111328125,4.05688671875,4.055232421875,4.05441015625,4.052625,4.05313671875,4.05051171875,4.049529296875,4.0474765625,4.04734765625,4.046658203125,4.04436328125,4.0429375,4.044142578125,4.04340234375,4.039486328125,4.0435625,4.04140234375,4.0408046875,4.0386015625,4.0380625,4.037591796875,4.032896484375,4.0354765625,4.035083984375,4.03198828125,4.032712890625,4.030740234375,4.02956640625,4.029828125,4.0271875,4.025908203125,4.0264765625,4.024916015625,4.02585546875,4.024517578125,4.024865234375,4.02329296875,4.022279296875,4.021298828125,4.021123046875,4.021474609375,4.02086328125,4.01965234375,4.01898046875,4.01805859375,4.017619140625,4.01712109375,4.015287109375,4.01531640625,4.016392578125,4.014390625,4.013958984375,4.0118671875,4.0142265625,4.01219140625,4.011998046875,4.011248046875,4.010705078125,4.01103125,4.01233984375,4.008513671875,4.01001953125,4.00755078125,4.008427734375,4.00748046875,4.006416015625,4.007978515625,4.005435546875,4.00546875,4.00516015625,4.00378515625,4.00555859375,4.0049765625,4.005669921875,4.005052734375,4.002826171875,4.003580078125,4.002212890625,4.00363671875,4.001841796875,4.00212890625,4.003541015625,4.002578125,4.0037109375,4.00257421875],"type":"scatter"},{"name":"Mixture of Tokens","x":[1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0,9000.0,10000.0,11000.0,12000.0,13000.0,14000.0,15000.0,16000.0,17000.0,18000.0,19000.0,20000.0,21000.0,22000.0,23000.0,24000.0,25000.0,26000.0,27000.0,28000.0,29000.0,30000.0,31000.0,32000.0,33000.0,34000.0,35000.0,36000.0,37000.0,38000.0,39000.0,40000.0,41000.0,42000.0,43000.0,44000.0,45000.0,46000.0,47000.0,48000.0,49000.0,50000.0,51000.0,52000.0,53000.0,54000.0,55000.0,56000.0,57000.0,58000.0,59000.0,60000.0,61000.0,62000.0,63000.0,64000.0,65000.0,66000.0,67000.0,68000.0,69000.0,70000.0,71000.0,72000.0,73000.0,74000.0,75000.0,76000.0,77000.0,78000.0,79000.0,80000.0,81000.0,82000.0,83000.0,84000.0,85000.0,86000.0,87000.0,88000.0,89000.0,90000.0,91000.0,92000.0,93000.0,94000.0,95000.0,96000.0,97000.0,98000.0,99000.0,100000.0,101000.0,102000.0,103000.0,104000.0,105000.0,106000.0,107000.0,108000.0,109000.0,110000.0,111000.0,112000.0,113000.0,114000.0,115000.0,116000.0,117000.0,118000.0,119000.0,120000.0,121000.0,122000.0,123000.0,124000.0,125000.0,126000.0,127000.0,128000.0,129000.0,130000.0,131000.0,132000.0,133000.0,134000.0,135000.0,136000.0,137000.0,138000.0,139000.0,140000.0,141000.0,142000.0,143000.0,144000.0,145000.0,146000.0,147000.0,148000.0,149000.0,150000.0,151000.0,152000.0,153000.0,154000.0,155000.0,156000.0,157000.0,158000.0,159000.0,160000.0,161000.0,162000.0,163000.0,164000.0,165000.0,166000.0,167000.0,168000.0,169000.0,170000.0,171000.0,172000.0,173000.0,174000.0,175000.0,176000.0,177000.0,178000.0,179000.0,180000.0,181000.0,182000.0,183000.0,184000.0,185000.0,186000.0,187000.0,188000.0,189000.0,190000.0,191000.0,192000.0,193000.0,194000.0,195000.0,196000.0,197000.0,198000.0,199000.0,200000.0,201000.0,202000.0,203000.0,204000.0,205000.0,206000.0,207000.0,208000.0,209000.0,210000.0,211000.0,212000.0,213000.0,214000.0,215000.0,216000.0,217000.0,218000.0,219000.0,220000.0,221000.0,222000.0,223000.0,224000.0,225000.0,226000.0,227000.0,228000.0,229000.0,230000.0,231000.0,232000.0,233000.0,234000.0,235000.0,236000.0,237000.0,238000.0,239000.0,240000.0,241000.0,242000.0,243000.0,244000.0,245000.0,246000.0,247000.0,248000.0,249000.0,250000.0],"y":[6.865790036678314,5.500211125850678,5.061204619407654,4.781460484981537,4.641498310565948,4.555344714164734,4.490929737091064,4.443757008075714,4.405196396350861,4.37313479423523,4.344426648139954,4.323108457088471,4.299607085704803,4.279431181430817,4.263306029796601,4.247776464939117,4.234482085704803,4.221364744663239,4.2098522415161135,4.196074651241302,4.187593363761902,4.177408302307129,4.170638454437256,4.159920306205749,4.15081564617157,4.145412252902984,4.139124257087707,4.131852756023407,4.123324332237243,4.11731966304779,4.113346085071564,4.107695070266724,4.101226757526398,4.098156608104706,4.091862853527069,4.088939291715622,4.08453405046463,4.080003803968429,4.07474255156517,4.069562127351761,4.0672049102783205,4.064178363561631,4.0609314668178556,4.056524780988693,4.053007598161697,4.047103298664093,4.043819102048874,4.0414996073246,4.038083200454712,4.03592233991623,4.032123554468155,4.029180178403855,4.027229268789291,4.024126539945603,4.02128267121315,4.018775345087051,4.0136179099082945,4.012527460336686,4.011893786191941,4.0094586644172665,4.003874507665635,4.00408109164238,3.9995777270793913,3.997126739740372,3.9969446184635165,3.9934199278354643,3.9913556628227234,3.9893966519832613,3.9867340905666353,3.986563229560852,3.9814727687835694,3.9834299783706664,3.978228116750717,3.9784797337055204,3.974903697013855,3.972870152950287,3.9708729276657104,3.9691721091270447,3.9676777884960175,3.9655341460704805,3.962736085653305,3.9628406882286074,3.958150596380234,3.9572064304351806,3.9572911744117736,3.9544747989177704,3.9525790514945984,3.9521092398166657,3.9483649508953094,3.948203722476959,3.945921738624573,3.9438791739940644,3.9440752167701723,3.942056930065155,3.9397456793785097,3.938746748685837,3.937531670331955,3.9344002854824067,3.931611962556839,3.932666870355606,3.9304284567832948,3.9282506439685823,3.9271608049869537,3.9252567477226257,3.9263192043304445,3.9234907367229463,3.9210682899951936,3.921439744234085,3.919512340307236,3.916478786468506,3.918222924232483,3.912615067720413,3.909725915670395,3.91176522898674,3.9081051626205445,3.9083814005851747,3.9069166042804717,3.9061199796199797,3.9035818481445315,3.903709605693817,3.9023211553096773,3.8991231470108034,3.89718363571167,3.899226724386215,3.8953543226718903,3.8952864673137664,3.8937351932525637,3.8945165870189666,3.8917897469997405,3.8874791808128357,3.889599235296249,3.886183403491974,3.8874019949436187,3.885254539966583,3.881638179540634,3.884223243713379,3.883069363594055,3.880081481218338,3.878324861049652,3.8768155725002287,3.8742032346725463,3.8739651515483855,3.873274619817734,3.8733756947517395,3.8730960862636565,3.8718043982982637,3.8683799533843994,3.8676790974140167,3.8672288568019866,3.8673909361362457,3.8659597504138947,3.863656238079071,3.8642505462169647,3.8606404564380647,3.858939951658249,3.858395966768265,3.8568559811115266,3.8574499735832215,3.855578766822815,3.8548514432907104,3.8535311052799224,3.852460629701614,3.8520446791648864,3.850679286956787,3.849676181077957,3.8503636083602903,3.8481787927150726,3.847291652441025,3.846029278039932,3.8467375905513763,3.843457180738449,3.8432434759140013,3.84123197722435,3.8409913368225097,3.8404709768295286,3.838491157054901,3.8369598042964936,3.8380221192836763,3.8370410463809965,3.833674565553665,3.837532728433609,3.8359467537403105,3.834789340496063,3.8331626744270326,3.832846212863922,3.831990896940231,3.8268260090351105,3.8300914266109465,3.8295945544242858,3.8270066785812378,3.8272946214675905,3.825755661725998,3.8243437113761902,3.8244080152511595,3.8222766811847686,3.820967532634735,3.8215505781173706,3.820350860118866,3.8214788076877593,3.8193533620834352,3.819955214738846,3.8186098570823668,3.8177401185035706,3.817552139997482,3.816974099159241,3.817406270503998,3.8170814564228057,3.8157693605422973,3.8148661241531374,3.814633913755417,3.8133696205615997,3.813557290315628,3.81179550242424,3.811197649717331,3.812590065956116,3.810574800014496,3.811046081781387,3.808258488416672,3.810983619213104,3.808893218278885,3.8086019842624665,3.8076923871040345,3.8071739885807037,3.8074519782066347,3.8087132613658907,3.8052890610694887,3.806961742401123,3.8044023671150207,3.80590287733078,3.8039762332439424,3.8035476679801943,3.8046592409610747,3.8024042971134184,3.802197088241577,3.801558027267456,3.8005723276138306,3.8025530395507814,3.8023419806957244,3.802598600387573,3.8017730872631073,3.7998546545505523,3.8000860295295715,3.7992646408081057,3.8004151334762573,3.7985526072978972,3.798954046010971,3.800132167816162,3.799162902355194,3.8003664946556093,3.798871917963028],"type":"scatter"}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"title":{"text":"Training Loss vs Step","x":0.5},"shapes":[{"line":{"color":"red","dash":"dot","width":0.5},"type":"line","x0":61000.0,"x1":250000.0,"y0":4.00257421875,"y1":4.00257421875}],"annotations":[{"arrowcolor":"red","arrowhead":3,"arrowwidth":0.5,"ax":0.0,"ay":50,"font":{"color":"red","size":11},"showarrow":true,"text":"24% of training steps","x":117700.0,"y":4.00257421875}],"xaxis":{"range":[0,250000.0],"title":{"text":"training step"}},"yaxis":{"range":[3.5,5],"title":{"text":"loss"}}},                        {"responsive": true}                    )                };                            </script>        </div>


<p>Our Mixture of Tokens model attains the dense models’ final training loss in just 24% of steps. <span class="SA">update plot SA after training finished</span> <span class="SA">ZTODO zmienić 24% of traning steps na czarny kolor i tę kreseczkę też, przerywana linia też w innym kolorze</span></p>


<meta charset="utf-8">

    <div>                            <div id="47e07449-2fe2-4647-a0d1-69d134577886" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("47e07449-2fe2-4647-a0d1-69d134577886")) {                    Plotly.newPlot(                        "47e07449-2fe2-4647-a0d1-69d134577886",                        [{"name":"Baseline","x":[0.0,0.08762166666666667,0.17644361111111112,0.26527666666666666,0.3539075,0.4435047222222222,0.5321094444444444,0.6218075000000001,0.7105758333333333,0.7999666666666667,0.8883986111111112,0.9774852777777778,1.0673408333333334,1.1558666666666666,1.2442119444444444,1.3331069444444446,1.419881388888889,1.5081022222222222,1.5953297222222222,1.6828311111111112,1.7700372222222223,1.8575183333333334,1.9448580555555555,2.0327033333333335,2.121116944444444,2.2089166666666666,2.29659,2.385211388888889,2.473233333333333,2.559935,2.6478683333333333,2.7348616666666667,2.8230225,2.9098430555555552,2.998060277777778,3.0854044444444444,3.1721883333333336,3.2592933333333334,3.3472327777777777,3.433851388888889,3.521051388888889,3.609291666666667,3.6965080555555554,3.7832800000000004,3.8702430555555556,3.9576874999999996,4.044698333333334,4.1319525,4.218946944444444,4.306704444444445,4.393870277777778,4.481081388888889,4.568294444444445,4.655444444444444,4.742686388888888,4.8297897222222215,4.916908888888889,5.004116111111111,5.0910649999999995,5.178214166666667,5.265334999999999,5.3524344444444445,5.439638333333334,5.526818333333333,5.613704722222222,5.700817499999999,5.787931944444445,5.875058888888889,5.962191666666667,6.049612222222222,6.136620833333333,6.224062222222222,6.311106666666666,6.398553611111112,6.4857233333333335,6.572978055555556,6.6600463888888894,6.7472336111111115,6.834268333333334,6.921397222222222,7.00843111111111,7.095643055555556,7.182788888888889,7.2697433333333334,7.356875,7.443795,7.530955277777777,7.6179775,7.704945833333333,7.792298611111112,7.879179722222222,7.966483888888889,8.053386944444444,8.140718055555554,8.227731944444445,8.315153333333333,8.401953055555555,8.489047222222222,8.57599888888889,8.6630075,8.750449444444444,8.83744138888889,8.92451,9.01161361111111,9.09861861111111,9.185570555555554,9.27280861111111,9.359810833333334,9.446755555555555,9.533864999999999,9.620834166666667,9.707910833333333,9.794974722222221,9.8820975,9.969790833333334,10.059529166666668,10.148275277777778,10.237225555555556,10.325973055555554,10.413803611111112,10.500648055555555,10.588213055555556,10.67548861111111,10.762519166666667,10.850113055555555,10.937474166666666,11.025301944444445,11.11185888888889,11.199786666666668,11.2870425,11.374980555555556,11.462117222222224,11.549749166666667,11.636829444444444,11.724797222222222,11.811960555555554,11.899705555555556,11.987722777777778,12.074925555555556,12.162574166666667,12.250062777777778,12.337125277777778,12.42514888888889,12.511965277777778,12.59950138888889,12.687078055555556,12.77459138888889,12.862399166666668,12.949969166666667,13.038156388888888,13.12617388888889,13.214363888888888,13.302555555555555,13.390345833333335,13.477509722222223,13.565365,13.65278638888889,13.741053888888889,13.828498055555556,13.917450277777778,14.0049925,14.092954166666667,14.180871388888889,14.269054166666667,14.35682,14.444571944444446,14.532745555555556,14.621474444444443,14.70994611111111,14.798998888888889,14.88682,14.975245555555555,15.063854444444443,15.151840277777778,15.239972222222223,15.328056388888887,15.416480555555555,15.505451111111112,15.593709166666667,15.682551388888887,15.770987222222221,15.859359166666666,15.947549166666668,16.035676111111112,16.124238333333334,16.212366666666664,16.3009725,16.389469444444444,16.477648333333335,16.56602611111111,16.654208055555554,16.7425775,16.830786111111113,16.918509444444442,17.00650472222222,17.094911111111113,17.183713333333333,17.272284444444445,17.36049527777778,17.449826388888887,17.538273611111112,17.62639638888889,17.715115555555556,17.802473333333335,17.891330555555555,17.980198333333334,18.069332777777777,18.158273333333334,18.24664333333333,18.335828611111108,18.424611666666667,18.51265777777778,18.601486666666666,18.690482499999998,18.779454722222223,18.868869166666666,18.95748888888889,19.0462675,19.135793333333332,19.22511777777778,19.313645833333332,19.402723055555555,19.492199444444445,19.581441666666667,19.670004166666665,19.759194444444447,19.847888333333334,19.93624,20.025037777777776,20.11338388888889,20.202275,20.29097833333333,20.37863888888889,20.467515833333334,20.556151944444444,20.644791944444446,20.733088611111114,20.821204722222223,20.909725277777778,20.998593055555556,21.086310555555553,21.174205555555556,21.26254472222222,21.351176666666667,21.440162222222224,21.528179166666668,21.61698777777778,21.705759444444443,21.794127777777778,21.883115000000004],"y":[6.74839453125,5.4187265625,4.9736796875,4.735296875,4.630875,4.56698828125,4.519,4.4851484375,4.45952734375,4.43978515625,4.42198828125,4.4113125,4.39663671875,4.38164453125,4.37398046875,4.363734375,4.3577890625,4.34557421875,4.3384140625,4.32876171875,4.3243203125,4.319109375,4.3143203125,4.30580078125,4.2994453125,4.2956015625,4.292625,4.28841796875,4.28327734375,4.2778046875,4.277015625,4.272265625,4.2683046875,4.2671953125,4.262171875,4.26112109375,4.258078125,4.25455859375,4.25040625,4.24560546875,4.2448046875,4.24388671875,4.243,4.237890625,4.235296875,4.23173046875,4.2287109375,4.22712109375,4.22437109375,4.22453125,4.2206796875,4.21865625,4.21700390625,4.2149140625,4.21329296875,4.21173828125,4.20691015625,4.20617578125,4.20566015625,4.2051171875,4.199109375,4.20054296875,4.19573046875,4.19511328125,4.19466015625,4.1915859375,4.190609375,4.18851171875,4.18603125,4.1866171875,4.1823828125,4.1841171875,4.17944140625,4.18012890625,4.17614453125,4.17441015625,4.1732734375,4.171921875,4.1710234375,4.16890625,4.16660546875,4.1675703125,4.16252734375,4.161875,4.16170703125,4.159328125,4.15687890625,4.15765625,4.1536953125,4.15349609375,4.151734375,4.15009765625,4.15083203125,4.1477578125,4.14693359375,4.14521484375,4.14371875,4.140640625,4.1391875,4.1400859375,4.13821875,4.136171875,4.1346953125,4.13290234375,4.13382421875,4.1321171875,4.127845703125,4.12960546875,4.1271328125,4.124853515625,4.126546875,4.12116015625,4.118875,4.1194375,4.11716796875,4.117326171875,4.11452734375,4.11478515625,4.11265625,4.1118515625,4.110716796875,4.10695703125,4.105974609375,4.1069453125,4.1039609375,4.104115234375,4.10241796875,4.10298046875,4.100599609375,4.09512890625,4.09860546875,4.094466796875,4.09503515625,4.093646484375,4.08973828125,4.09240234375,4.09222265625,4.088080078125,4.08678515625,4.085791015625,4.082439453125,4.082064453125,4.08147265625,4.080451171875,4.08063671875,4.07994921875,4.07630078125,4.07576953125,4.074875,4.07455078125,4.073796875,4.071392578125,4.072060546875,4.06762890625,4.066365234375,4.0654765625,4.064796875,4.06455078125,4.0633359375,4.061970703125,4.060384765625,4.0594140625,4.059236328125,4.057814453125,4.056111328125,4.05688671875,4.055232421875,4.05441015625,4.052625,4.05313671875,4.05051171875,4.049529296875,4.0474765625,4.04734765625,4.046658203125,4.04436328125,4.0429375,4.044142578125,4.04340234375,4.039486328125,4.0435625,4.04140234375,4.0408046875,4.0386015625,4.0380625,4.037591796875,4.032896484375,4.0354765625,4.035083984375,4.03198828125,4.032712890625,4.030740234375,4.02956640625,4.029828125,4.0271875,4.025908203125,4.0264765625,4.024916015625,4.02585546875,4.024517578125,4.024865234375,4.02329296875,4.022279296875,4.021298828125,4.021123046875,4.021474609375,4.02086328125,4.01965234375,4.01898046875,4.01805859375,4.017619140625,4.01712109375,4.015287109375,4.01531640625,4.016392578125,4.014390625,4.013958984375,4.0118671875,4.0142265625,4.01219140625,4.011998046875,4.011248046875,4.010705078125,4.01103125,4.01233984375,4.008513671875,4.01001953125,4.00755078125,4.008427734375,4.00748046875,4.006416015625,4.007978515625,4.005435546875,4.00546875,4.00516015625,4.00378515625,4.00555859375,4.0049765625,4.005669921875,4.005052734375,4.002826171875,4.003580078125,4.002212890625,4.00363671875,4.001841796875,4.00212890625,4.003541015625,4.002578125,4.0037109375,4.00257421875],"type":"scatter"},{"name":"Mixture of Tokens","x":[0.0,0.1102025,0.22032138888888889,0.33063944444444443,0.4408547222222222,0.55116,0.6615341666666668,0.7717666666666667,0.8822316666666667,0.9925736111111111,1.1029411111111111,1.2137411111111112,1.324238888888889,1.4347152777777779,1.5451597222222222,1.655526388888889,1.765925,1.8763033333333334,1.9867336111111111,2.0971166666666665,2.2076133333333336,2.318064166666667,2.4284366666666664,2.5388622222222224,2.6492127777777776,2.7596202777777776,2.870053333333333,2.9804244444444445,3.0908752777777777,3.201222222222222,3.311739166666667,3.4221605555555556,3.532686388888889,3.643100555555556,3.7536358333333335,3.8640230555555557,3.974463611111111,4.084901111111111,4.195413333333333,4.305719722222222,4.416119722222223,4.526548611111111,4.636904722222222,4.7472297222222215,4.8576258333333335,4.967887777777778,5.078225277777778,5.188641388888889,5.298884722222223,5.409263055555556,5.519609444444445,5.629938888888889,5.740241944444445,5.850555277777778,5.960919722222223,6.0711772222222224,6.181602222222223,6.291845555555556,6.402167222222222,6.512474444444444,6.622768333333333,6.732979444444444,6.843288055555555,6.843288055555555,6.953314722222222,7.063289722222223,7.173268055555557,7.283314166666667,7.3932725,7.503346666666667,7.613356111111111,7.723425000000001,7.833574722222222,7.9436550000000015,8.053704999999999,8.163783055555555,8.273855833333334,8.383854722222223,8.49399611111111,8.604089722222222,8.71408138888889,8.824217500000001,8.934220833333333,9.044411666666665,9.154599166666667,9.264683611111112,9.374765277777778,9.4850125,9.595071111111112,9.705115000000001,9.815252222222224,9.925120833333335,10.035108055555556,10.1452525,10.255217777777778,10.365317500000002,10.475235,10.585409166666667,10.695249722222224,10.80515611111111,10.9150025,11.024954722222223,11.135028333333333,11.245003333333335,11.354947222222224,11.465120555555556,11.575130833333333,11.685120555555557,11.79513388888889,11.905186944444445,12.015026111111112,12.124869722222224,12.235156111111111,12.345049444444445,12.454888055555555,12.564795555555555,12.674625277777777,12.784670833333333,12.894639722222223,13.004474444444444,13.114481666666666,13.224713611111113,13.3347425,13.444596944444443,13.554369722222223,13.66424277777778,13.774108611111112,13.884061666666668,13.994094722222222,14.103895277777777,14.213770555555556,14.323564444444445,14.433430833333334,14.543593055555556,14.653517222222224,14.763287777777778,14.873133333333334,14.983110833333333,15.093224166666669,15.202986111111112,15.312870277777776,15.422733055555554,15.53278277777778,15.64267638888889,15.752639444444444,15.862639444444444,15.972501944444442,16.082318333333333,16.19223777777778,16.302058055555555,16.412016944444446,16.521855277777778,16.631579444444444,16.741500000000002,16.85148388888889,16.961374444444445,17.07116388888889,17.181066666666666,17.290792777777778,17.40053888888889,17.510147222222223,17.619923611111112,17.72970972222222,17.83961888888889,17.949476944444445,18.05931222222222,18.168992222222222,18.279121666666665,18.388841944444444,18.498518611111113,18.60816916666667,18.71802361111111,18.827864722222223,18.937888333333337,19.047698333333333,19.15737777777778,19.267007222222222,19.376971944444442,19.486947777777775,19.59681972222222,19.70655277777778,19.816338055555555,19.92609361111111,20.035820277777777,20.145579722222223,20.255375833333332,20.365146666666668,20.47489638888889,20.58456638888889,20.694322222222223,20.80390611111111,20.913588055555557,21.023211944444444,21.132928055555556,21.2426775,21.352590833333334,21.462215277777776,21.571809722222223,21.68151138888889,21.79109777777778,21.90075555555556,22.010525833333336,22.12054277777778,22.230148888888888,22.339839444444443,22.449536666666667,22.55939138888889,22.669127222222222,22.778843333333334,22.888418333333334,22.998050833333334,23.107671111111113,23.21736416666667,23.32705888888889,23.436874444444445,23.54648666666667,23.6560725,23.765639999999998,23.87541388888889,23.985128888888887,24.09484,24.204535000000003,24.314268888888886,24.423895555555553,24.533535,24.643296111111113,24.753114444444446,24.862688333333335,24.9724975,25.082420000000003,25.192441666666667,25.302096388888888,25.41210277777778,25.521807222222222,25.631496388888888,25.741141111111112,25.85082,25.9608,26.070731944444447,26.180374722222222,26.29001638888889,26.399621111111113,26.509409444444444,26.619260555555556,26.728955000000003,26.838776388888892,26.948435833333335,27.058179166666665,27.168012500000003,27.27768888888889],"y":[6.865790036678314,5.500211125850678,5.061204619407654,4.781460484981537,4.641498310565948,4.555344714164734,4.490929737091064,4.443757008075714,4.405196396350861,4.37313479423523,4.344426648139954,4.323108457088471,4.299607085704803,4.279431181430817,4.263306029796601,4.247776464939117,4.234482085704803,4.221364744663239,4.2098522415161135,4.196074651241302,4.187593363761902,4.177408302307129,4.170638454437256,4.159920306205749,4.15081564617157,4.145412252902984,4.139124257087707,4.131852756023407,4.123324332237243,4.11731966304779,4.113346085071564,4.107695070266724,4.101226757526398,4.098156608104706,4.091862853527069,4.088939291715622,4.08453405046463,4.080003803968429,4.07474255156517,4.069562127351761,4.0672049102783205,4.064178363561631,4.0609314668178556,4.056524780988693,4.053007598161697,4.047103298664093,4.043819102048874,4.0414996073246,4.038083200454712,4.03592233991623,4.032123554468155,4.029180178403855,4.027229268789291,4.024126539945603,4.02128267121315,4.018775345087051,4.0136179099082945,4.012527460336686,4.011893786191941,4.0094586644172665,4.003874507665635,4.00408109164238,3.9995777270793913,3.997126739740372,3.9969446184635165,3.9934199278354643,3.9913556628227234,3.9893966519832613,3.9867340905666353,3.986563229560852,3.9814727687835694,3.9834299783706664,3.978228116750717,3.9784797337055204,3.974903697013855,3.972870152950287,3.9708729276657104,3.9691721091270447,3.9676777884960175,3.9655341460704805,3.962736085653305,3.9628406882286074,3.958150596380234,3.9572064304351806,3.9572911744117736,3.9544747989177704,3.9525790514945984,3.9521092398166657,3.9483649508953094,3.948203722476959,3.945921738624573,3.9438791739940644,3.9440752167701723,3.942056930065155,3.9397456793785097,3.938746748685837,3.937531670331955,3.9344002854824067,3.931611962556839,3.932666870355606,3.9304284567832948,3.9282506439685823,3.9271608049869537,3.9252567477226257,3.9263192043304445,3.9234907367229463,3.9210682899951936,3.921439744234085,3.919512340307236,3.916478786468506,3.918222924232483,3.912615067720413,3.909725915670395,3.91176522898674,3.9081051626205445,3.9083814005851747,3.9069166042804717,3.9061199796199797,3.9035818481445315,3.903709605693817,3.9023211553096773,3.8991231470108034,3.89718363571167,3.899226724386215,3.8953543226718903,3.8952864673137664,3.8937351932525637,3.8945165870189666,3.8917897469997405,3.8874791808128357,3.889599235296249,3.886183403491974,3.8874019949436187,3.885254539966583,3.881638179540634,3.884223243713379,3.883069363594055,3.880081481218338,3.878324861049652,3.8768155725002287,3.8742032346725463,3.8739651515483855,3.873274619817734,3.8733756947517395,3.8730960862636565,3.8718043982982637,3.8683799533843994,3.8676790974140167,3.8672288568019866,3.8673909361362457,3.8659597504138947,3.863656238079071,3.8642505462169647,3.8606404564380647,3.858939951658249,3.858395966768265,3.8568559811115266,3.8574499735832215,3.855578766822815,3.8548514432907104,3.8535311052799224,3.852460629701614,3.8520446791648864,3.850679286956787,3.849676181077957,3.8503636083602903,3.8481787927150726,3.847291652441025,3.846029278039932,3.8467375905513763,3.843457180738449,3.8432434759140013,3.84123197722435,3.8409913368225097,3.8404709768295286,3.838491157054901,3.8369598042964936,3.8380221192836763,3.8370410463809965,3.833674565553665,3.837532728433609,3.8359467537403105,3.834789340496063,3.8331626744270326,3.832846212863922,3.831990896940231,3.8268260090351105,3.8300914266109465,3.8295945544242858,3.8270066785812378,3.8272946214675905,3.825755661725998,3.8243437113761902,3.8244080152511595,3.8222766811847686,3.820967532634735,3.8215505781173706,3.820350860118866,3.8214788076877593,3.8193533620834352,3.819955214738846,3.8186098570823668,3.8177401185035706,3.817552139997482,3.816974099159241,3.817406270503998,3.8170814564228057,3.8157693605422973,3.8148661241531374,3.814633913755417,3.8133696205615997,3.813557290315628,3.81179550242424,3.811197649717331,3.812590065956116,3.810574800014496,3.811046081781387,3.808258488416672,3.810983619213104,3.808893218278885,3.8086019842624665,3.8076923871040345,3.8071739885807037,3.8074519782066347,3.8087132613658907,3.8052890610694887,3.806961742401123,3.8044023671150207,3.80590287733078,3.8039762332439424,3.8035476679801943,3.8046592409610747,3.8024042971134184,3.802197088241577,3.801558027267456,3.8005723276138306,3.8025530395507814,3.8023419806957244,3.802598600387573,3.8017730872631073,3.7998546545505523,3.8000860295295715,3.7992646408081057,3.8004151334762573,3.7985526072978972,3.798954046010971,3.800132167816162,3.799162902355194,3.8003664946556093,3.798871917963028],"type":"scatter"}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"title":{"text":"Training Loss vs Time","x":0.5},"shapes":[{"line":{"color":"red","dash":"dot","width":0.5},"type":"line","x0":61000.0,"x1":250000.0,"y0":4.00257421875,"y1":4.00257421875},{"line":{"color":"red","dash":"dot","width":0.5},"type":"line","x0":6.622768333333333,"x1":21.883115000000004,"y0":4.00257421875,"y1":4.00257421875}],"annotations":[{"arrowcolor":"red","arrowhead":3,"arrowwidth":0.5,"ax":0.0,"ay":50,"font":{"color":"red","size":11},"showarrow":true,"text":"24% of training steps","x":117700.0,"y":4.00257421875},{"arrowcolor":"red","arrowhead":3,"arrowwidth":0.5,"ax":0.0,"ay":50,"font":{"color":"red","size":11},"showarrow":true,"text":"33% of training time","x":11.200872333333333,"y":4.00257421875}],"xaxis":{"range":[0,21.8],"title":{"text":"time (hours)"}},"yaxis":{"range":[3.5,5],"title":{"text":"loss"}}},                        {"responsive": true}                    )                };                            </script>        </div>


<p>If we measure actual training time, the final dense model loss is achieved in only 33% of time. <span class="SA">update plot SA after training finished</span> <span class="SA">ZTODO zmienić 33% of traning steps na czarny kolor i tę kreseczkę też, przerywana linia też w innym kolorze</span></p>
</section>
</section>
<section id="next-steps" class="level1">
<h1>Next steps</h1>
<section id="scaling-up" class="level2">
<h2 class="anchored" data-anchor-id="scaling-up">Scaling Up</h2>
<p>Our preliminary experiments suggest that Mixture of Tokens might work even better for larger model sizes. In upcoming weeks we aim to prepare comprehensive comparison of larger models and compare them to Mixture of Experts methods.</p>
</section>
<section id="from-mixture-of-tokens-to-mixture-of-experts" class="level2">
<h2 class="anchored" data-anchor-id="from-mixture-of-tokens-to-mixture-of-experts">From Mixture of Tokens to Mixture of Experts</h2>
<p>In the default Mixture of Tokens setup for autoregressive training, tokens from different examples in the batch are mixed. This, in principle, opens a possibility of teasing out the output of one sample from another in the same batch - which might be undesirable in some use cases.</p>
<p>To quantify the rate of token mixing we investigated the evolution of the mean entropy of weights produced by Mixture of Tokens layers. In other words: in each layer, we average the entropy of weights over all token groups and all experts.</p>
<p>For the base version of MoT, the results are as follows:</p>


<meta charset="utf-8">

    <div>                            <div id="a648d79b-be0a-4885-82ab-22a84fcd4e09" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("a648d79b-be0a-4885-82ab-22a84fcd4e09")) {                    Plotly.newPlot(                        "a648d79b-be0a-4885-82ab-22a84fcd4e09",                        [{"legendwidth":3,"name":" block 0","x":[1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0,9000.0,10000.0,11000.0,12000.0,13000.0,14000.0,15000.0,16000.0,17000.0,18000.0,19000.0,20000.0,21000.0,22000.0,23000.0,24000.0,25000.0,26000.0,27000.0,28000.0,29000.0,30000.0,31000.0,32000.0,33000.0,34000.0,35000.0,36000.0,37000.0,38000.0,39000.0,40000.0,41000.0,42000.0,43000.0,44000.0,45000.0,46000.0,47000.0,48000.0,49000.0,50000.0,51000.0,52000.0,53000.0,54000.0,55000.0,56000.0,57000.0,58000.0,59000.0,60000.0,61000.0,62000.0,63000.0,64000.0,65000.0,66000.0,67000.0,68000.0,69000.0,70000.0,71000.0,72000.0,73000.0,74000.0,75000.0,76000.0,77000.0,78000.0,79000.0,80000.0,81000.0,82000.0,83000.0,84000.0,85000.0,86000.0,87000.0,88000.0,89000.0,90000.0,91000.0,92000.0,93000.0,94000.0,95000.0,96000.0,97000.0,98000.0,99000.0,100000.0,101000.0],"y":[0.92165743496418,0.9537076325654984,0.9641520408630371,0.9707946148872375,0.9748303187131881,0.9772490072488785,0.9792727726221084,0.9803931768417359,0.9815029253959656,0.9809452077388764,0.9812650203943253,0.9809211638689042,0.9799649496793746,0.9803055855035782,0.9800663259506226,0.9794309798002243,0.9785979282617568,0.9779348073244095,0.9774929559230805,0.9772777146816254,0.9772291843891143,0.9765390749454498,0.9752409230470658,0.9747462890148163,0.9736543172121048,0.9738814332008362,0.9725726986408234,0.9729867669343948,0.9725049557209015,0.971193381512165,0.9700378065824509,0.972120799267292,0.9702390851020813,0.9693312009096146,0.9705306073665619,0.9687958587646485,0.9685319063425064,0.9682176224827767,0.9681972056150436,0.9683018844604492,0.9672884285211563,0.9655007892966271,0.9668098423957825,0.9658587105512619,0.9649084169149399,0.9650109154939651,0.9643661723136902,0.9643112291097641,0.9625832327723504,0.9634430497288704,0.9629028873562813,0.9611653248071671,0.9613701857089997,0.9607486838459969,0.9617892017006874,0.9611273327589035,0.9614785772919655,0.9613744383573533,0.960025037920475,0.9590885294675827,0.9589457839488983,0.9568801142811775,0.958223774266243,0.9586807201385498,0.9577963348984718,0.9578436374306679,0.954541852235794,0.9572062803983689,0.9582873189210892,0.954517337679863,0.956145688867569,0.954642564535141,0.956679963183403,0.9534107337117195,0.9545042137861252,0.9539822288274765,0.9531985828459263,0.954096318423748,0.9537069139003753,0.9547244686841965,0.9528305056095123,0.9524892906427384,0.9526572220802307,0.9507636413216591,0.9528706477046013,0.951709820073843,0.9508637555360794,0.9507011790513993,0.9524161209106445,0.9515883259534835,0.9491049999892711,0.9505788665294648,0.9486254699110985,0.9487330667257309,0.9499433557510376,0.9495876786828041,0.9483286616683007,0.9466950996160507,0.9473373399436474,0.9475804080843926,0.9464072032451629],"type":"scatter"},{"legendwidth":3,"name":" block 1","x":[1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0,9000.0,10000.0,11000.0,12000.0,13000.0,14000.0,15000.0,16000.0,17000.0,18000.0,19000.0,20000.0,21000.0,22000.0,23000.0,24000.0,25000.0,26000.0,27000.0,28000.0,29000.0,30000.0,31000.0,32000.0,33000.0,34000.0,35000.0,36000.0,37000.0,38000.0,39000.0,40000.0,41000.0,42000.0,43000.0,44000.0,45000.0,46000.0,47000.0,48000.0,49000.0,50000.0,51000.0,52000.0,53000.0,54000.0,55000.0,56000.0,57000.0,58000.0,59000.0,60000.0,61000.0,62000.0,63000.0,64000.0,65000.0,66000.0,67000.0,68000.0,69000.0,70000.0,71000.0,72000.0,73000.0,74000.0,75000.0,76000.0,77000.0,78000.0,79000.0,80000.0,81000.0,82000.0,83000.0,84000.0,85000.0,86000.0,87000.0,88000.0,89000.0,90000.0,91000.0,92000.0,93000.0,94000.0,95000.0,96000.0,97000.0,98000.0,99000.0,100000.0],"y":[0.8448272092223167,0.8217169033676386,0.8321842997014522,0.8321399267701433,0.8277010530701373,0.8165141468452756,0.8140942838557996,0.8121389493394643,0.8008707857378525,0.798304186603264,0.7835945077733719,0.7828037355650682,0.7833213209515205,0.7834315252395114,0.7780477473651175,0.7735495794006507,0.7638288771183055,0.7767243298908288,0.7691222990173731,0.7570353112551748,0.7560667943108798,0.757005366626769,0.7552742941594727,0.7483573015009221,0.7462340259422923,0.7458924244752568,0.7427659225831638,0.7379847318911125,0.743790123815689,0.7555631750343004,0.7327042521221862,0.73777696635631,0.7301552246783659,0.7332568694002563,0.7290530669171021,0.7221174256972445,0.736826236642812,0.7209475353189609,0.734492157463622,0.7256312675344075,0.7232308097283708,0.7187863171049105,0.7185497338263228,0.7367153626081594,0.7238405214633798,0.7149482413537176,0.7159919257308033,0.7121178625585975,0.7034054076721682,0.7034399343807074,0.7046593779982498,0.6986309523091809,0.7053715299483126,0.7030005521967072,0.7101364845934748,0.6999556888202049,0.702212187455371,0.6922109979403116,0.6991845773900535,0.701386817426171,0.6876890079641643,0.6985455523864684,0.6912573434411974,0.6823875464694888,0.6914654560182387,0.7020607347361297,0.6873143670311498,0.6830892979218166,0.6768999705660977,0.6731979591296078,0.6826270550779302,0.6751514521141379,0.6828046687322689,0.683308404654729,0.676021258819932,0.6735219463513533,0.6711647533092964,0.6766370332389774,0.6713873692686055,0.6677969265644766,0.6667771602909682,0.6612211314260283,0.6679332894531963,0.6618269348678301,0.6641376388928966,0.6546681990503103,0.6654422322223591,0.6606857070244463,0.6625996579640433,0.6567794547581776,0.6602965158752466,0.6662426366033551,0.6510068488170727,0.6552321177197268,0.6466896517605497,0.649204857083531,0.6516548634245714,0.6501904505805031,0.652594139582066,0.6440703149004332],"type":"scatter"},{"legendwidth":3,"name":" block 2","x":[1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0,9000.0,10000.0,11000.0,12000.0,13000.0,14000.0,15000.0,16000.0,17000.0,18000.0,19000.0,20000.0,21000.0,22000.0,23000.0,24000.0,25000.0,26000.0,27000.0,28000.0,29000.0,30000.0,31000.0,32000.0,33000.0,34000.0,35000.0,36000.0,37000.0,38000.0,39000.0,40000.0,41000.0,42000.0,43000.0,44000.0,45000.0,46000.0,47000.0,48000.0,49000.0,50000.0,51000.0,52000.0,53000.0,54000.0,55000.0,56000.0,57000.0,58000.0,59000.0,60000.0,61000.0,62000.0,63000.0,64000.0,65000.0,66000.0,67000.0,68000.0,69000.0,70000.0,71000.0,72000.0,73000.0,74000.0,75000.0,76000.0,77000.0,78000.0,79000.0,80000.0,81000.0,82000.0,83000.0,84000.0,85000.0,86000.0,87000.0,88000.0,89000.0,90000.0,91000.0,92000.0,93000.0,94000.0,95000.0,96000.0,97000.0,98000.0,99000.0,100000.0],"y":[0.7722973927922547,0.6559462137325136,0.6024278965591217,0.5783895385667075,0.5621955046894126,0.5506525123587184,0.5409721347910406,0.5338979229996966,0.5368617843583885,0.5190026022517572,0.5134305426328434,0.5060884857210918,0.518810770077041,0.49110075017527505,0.4956903163003131,0.49474360413376545,0.48675325834151034,0.48556659509335587,0.4697376942115404,0.4865743593682002,0.47882299562338665,0.4792569794440712,0.46555240875286774,0.46497373569015615,0.4646032187173756,0.46470145772857085,0.45538281869678504,0.46286638315631007,0.4662515777544999,0.4540631524942215,0.4550174711688217,0.43897561420519304,0.4528349189855568,0.44318131597870886,0.42669746122772123,0.4400195694959104,0.444899121665287,0.4303240912695432,0.42693079242509274,0.4235818214914406,0.4336392187232322,0.43046187944936465,0.4280177757852112,0.4215140363999206,0.42682098182089356,0.4302369472071487,0.4155343790575401,0.4180437433848709,0.42323378063424133,0.42280214147695017,0.40719545923301104,0.41905898498646255,0.4275089533399723,0.4145953412683295,0.402781341942201,0.4054356300172953,0.3954028975425128,0.40434580647045576,0.4026036180235803,0.4152863758088458,0.40942632119558775,0.3952778430029658,0.40064779413035156,0.40965680569117274,0.40883196409891787,0.40187835575768854,0.3990027065511298,0.3871524942678703,0.39073980584160106,0.39246004926150124,0.38742225447444817,0.3825635109133685,0.3885848280523137,0.3886826888848933,0.39586437771303107,0.3718449005974511,0.37864103530392046,0.39716207392271047,0.378479009069705,0.38670727978384556,0.3781415212406703,0.3740616612152167,0.38342091833532743,0.3629652990971918,0.3859590382536081,0.36995553924582447,0.37095099503650264,0.3769915975560255,0.3749623239016635,0.3592196345178012,0.37153408770509894,0.37871152805247044,0.36459816992476535,0.3753378888703937,0.3671763628380478,0.35711539640987905,0.34991736695061443,0.3600953984884578,0.36168713123632884,0.3512023155527678],"type":"scatter"},{"legendwidth":3,"name":" block 3","x":[1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0,9000.0,10000.0,11000.0,12000.0,13000.0,14000.0,15000.0,16000.0,17000.0,18000.0,19000.0,20000.0,21000.0,22000.0,23000.0,24000.0,25000.0,26000.0,27000.0,28000.0,29000.0,30000.0,31000.0,32000.0,33000.0,34000.0,35000.0,36000.0,37000.0,38000.0,39000.0,40000.0,41000.0,42000.0,43000.0,44000.0,45000.0,46000.0,47000.0,48000.0,49000.0,50000.0,51000.0,52000.0,53000.0,54000.0,55000.0,56000.0,57000.0,58000.0,59000.0,60000.0,61000.0,62000.0,63000.0,64000.0,65000.0,66000.0,67000.0,68000.0,69000.0,70000.0,71000.0,72000.0,73000.0,74000.0,75000.0,76000.0,77000.0,78000.0,79000.0,80000.0,81000.0,82000.0,83000.0,84000.0,85000.0,86000.0,87000.0,88000.0,89000.0,90000.0,91000.0,92000.0,93000.0,94000.0,95000.0,96000.0,97000.0,98000.0,99000.0,100000.0],"y":[0.8715342770397663,0.7563840482832166,0.6787617796732622,0.6528457936210447,0.6258480319176486,0.6167701655907164,0.5908677737925034,0.5625608380850808,0.553168118660172,0.5413605096366622,0.5371362210628268,0.5208337308690217,0.500715189199614,0.5131875762606299,0.4855127637560037,0.4787632030510622,0.49017494323011634,0.4744561730828431,0.4703783956524824,0.4643645489462219,0.4499479755333503,0.44304364668841845,0.4385655379950353,0.4483753401699074,0.45055119838459834,0.4433678617870539,0.4413828658033328,0.4143515089155264,0.41790545650279265,0.409716886232653,0.4164775029495541,0.4153489554596392,0.42129530001666116,0.39575785730884033,0.3986048113581078,0.39664891801199287,0.40149036977345687,0.39588152550976513,0.380501053674941,0.3871564977659722,0.3873142003157334,0.3972908046274407,0.39005280990460106,0.38230537468148434,0.3811394893728527,0.37433971095310564,0.36588672227086916,0.38594001070975775,0.37729162565715996,0.3600199444201515,0.36119389514538386,0.362499430104576,0.3619848948852615,0.35084061244380343,0.3523015611710458,0.3603563743001653,0.34828754460128686,0.36250620396798405,0.34684317296629236,0.33774791543417515,0.3509933290677892,0.33680192165539274,0.33659239384465006,0.3442538598237439,0.34214196307952965,0.33588723023925665,0.33817818437583475,0.32992137678777583,0.342627684748625,0.3256225838220834,0.3331347160754857,0.32714901844235567,0.3099391706641805,0.3237953711258679,0.3070028626662501,0.3127640469981423,0.32574220974099044,0.32155173354327743,0.3118888948699014,0.31953101684277546,0.3185955140292701,0.3048032246031492,0.3055707586859885,0.30984961762255464,0.30695482688295017,0.30554239344514567,0.3036470383680623,0.3223421485470438,0.3028053871244494,0.29802733198807274,0.3059280758551896,0.2907288318468633,0.29907489729361963,0.2864277255310832,0.3106224581154248,0.2870746413920228,0.2868439871416087,0.2916403426885214,0.29206981816071437,0.28223625568409],"type":"scatter"}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"title":{"text":"Mixture of Tokens mean entropy of controller weights vs step","x":0.5},"xaxis":{"range":[0,100000.0],"title":{"text":"training step"}},"yaxis":{"range":[0.0,1.0],"title":{"text":"normalized entropy"}}},                        {"responsive": true}                    )                };                            </script>        </div>


<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Backward Compatibility
</div>
</div>
<div class="callout-body-container callout-body">
<p>The controller produces merging weights by taking a softmax over scores calculated independently for each token. If it should happen that one score would dominate, for example by having very low temperature, the mixing operation would focus on exclusively one token. This, in effect, would make Mixture of Tokens equivalent to Token-Choice architecture.</p>
</div>
</div>
<p>As it turns out, allowing the temperature to be learnable, we effectively allow the model to lower rate of token mixing, especially in later layers:</p>


<meta charset="utf-8">

    <div>                            <div id="ca18035d-bf21-4568-b812-169c69bde817" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("ca18035d-bf21-4568-b812-169c69bde817")) {                    Plotly.newPlot(                        "ca18035d-bf21-4568-b812-169c69bde817",                        [{"legendwidth":3,"name":" block 0","x":[1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0,9000.0,10000.0,11000.0,12000.0,13000.0,14000.0,15000.0,16000.0,17000.0,18000.0,19000.0,20000.0,21000.0,22000.0,23000.0,24000.0,25000.0,26000.0,27000.0,28000.0,29000.0,30000.0,31000.0,32000.0,33000.0,34000.0,35000.0,36000.0,37000.0,38000.0,39000.0,40000.0,41000.0,42000.0,43000.0,44000.0,45000.0,46000.0,47000.0,48000.0,49000.0,50000.0,51000.0,52000.0,53000.0,54000.0,55000.0,56000.0,57000.0,58000.0,59000.0,60000.0,61000.0,62000.0,63000.0,64000.0,65000.0,66000.0,67000.0,68000.0,69000.0,70000.0,71000.0,72000.0,73000.0,74000.0,75000.0,76000.0,77000.0,78000.0,79000.0,80000.0,81000.0,82000.0,83000.0,84000.0,85000.0,86000.0,87000.0,88000.0,89000.0,90000.0,91000.0,92000.0,93000.0,94000.0,95000.0,96000.0,97000.0,98000.0],"y":[0.89086248909235,0.8644292178928852,0.8523376576393843,0.8486142926033586,0.8400725663350895,0.852438898584526,0.8437088695743121,0.8416408833896567,0.8384214633447875,0.838208167452825,0.8304289664540981,0.8390987699114588,0.8348054993933952,0.832502015713725,0.8291249090147812,0.8367012242144323,0.8313521085052576,0.8289861032769031,0.8315928379640068,0.8314172805224996,0.8359201511613019,0.8338472211609153,0.825757310867355,0.8265110114500054,0.8289206028524548,0.8326800642013099,0.8227166965956183,0.8364572617230226,0.8312763545330796,0.8361929567589635,0.8271251071165485,0.8366180827041906,0.8424304233471548,0.8368227513846077,0.8288042521832764,0.8468078449397075,0.8290758000724189,0.8368429309121377,0.8346154235289778,0.8409557789598866,0.8257166984982609,0.8403508026877936,0.8341345391232631,0.8324122544030792,0.8274218728967033,0.8319391852801349,0.8412568667424425,0.8359379903690286,0.8283483121914774,0.8310950115282744,0.8389336141445025,0.8204436027857537,0.835322708371594,0.8362537790127069,0.8383139328332195,0.8248578099684393,0.8352540714991253,0.8468696637945766,0.836755584168349,0.8351646215740554,0.8343299862837029,0.8309736611950953,0.8378195850667718,0.8326213155062451,0.8341084865037972,0.8351649405607859,0.8357892941238835,0.8405818851182867,0.8408711731698102,0.8389013791661589,0.8309207435371165,0.8415484996804312,0.8374351927639515,0.8430736563152376,0.8258967241586299,0.8259295080666805,0.833834044209552,0.8279855058945123,0.8304250654968731,0.8349615833999114,0.8407030041922117,0.8340771166525683,0.8314482023546563,0.8363641194375611,0.8316882868606819,0.8438857734246565,0.8341140189739417,0.8228204969157094,0.8276419306169268,0.8318715001306293,0.8364172200721312,0.8335525600158711,0.8277703761147314,0.8330009362914549,0.8242503774814016,0.8172291101948532,0.833876819385061,0.8274510631705758],"type":"scatter"},{"legendwidth":3,"name":" block 1","x":[1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0,9000.0,10000.0,11000.0,12000.0,13000.0,14000.0,15000.0,16000.0,17000.0,18000.0,19000.0,20000.0,21000.0,22000.0,23000.0,24000.0,25000.0,26000.0,27000.0,28000.0,29000.0,30000.0,31000.0,32000.0,33000.0,34000.0,35000.0,36000.0,37000.0,38000.0,39000.0,40000.0,41000.0,42000.0,43000.0,44000.0,45000.0,46000.0,47000.0,48000.0,49000.0,50000.0,51000.0,52000.0,53000.0,54000.0,55000.0,56000.0,57000.0,58000.0,59000.0,60000.0,61000.0,62000.0,63000.0,64000.0,65000.0,66000.0,67000.0,68000.0,69000.0,70000.0,71000.0,72000.0,73000.0,74000.0,75000.0,76000.0,77000.0,78000.0,79000.0,80000.0,81000.0,82000.0,83000.0,84000.0,85000.0,86000.0,87000.0,88000.0,89000.0,90000.0,91000.0,92000.0,93000.0,94000.0,95000.0,96000.0,97000.0],"y":[0.7904013652026654,0.7041459442342981,0.6527332540594505,0.6215502320222965,0.5997066967217645,0.5895811267837586,0.5638540130962567,0.5482966472836311,0.5482257710717406,0.5445516289886716,0.5299333176748166,0.5118093874162757,0.5127946552791608,0.4988313516136023,0.49552940912077775,0.48250768454816007,0.4727812751782991,0.4672652864035746,0.47032303958304267,0.4657289479116869,0.46885498606512555,0.45231046217302373,0.45579348714076595,0.45941626917390005,0.455969677726197,0.45866764803001986,0.45362316494987026,0.45186337396226256,0.4469991051936948,0.43547278607966344,0.4415331499786664,0.4383502118522067,0.4435555359800773,0.45777182236213576,0.44587231738081756,0.4399918648589568,0.42112844407761924,0.43996207785756053,0.436758847288627,0.42858397740182097,0.4430226076903378,0.4386000865802358,0.426943723839647,0.43871067636461647,0.4250367404809088,0.43881591459106295,0.4312418129772362,0.4424245444877224,0.43864615939725643,0.4230601672578694,0.42997644682174213,0.4322088173103701,0.4331277580587621,0.43906814448452397,0.4305478559919633,0.42502761156787744,0.42019778895976895,0.43427151283254917,0.4406816261989332,0.4291862242617683,0.4331927451830692,0.42831819975442176,0.42392962642389703,0.4314787970340427,0.4327969901045235,0.41628851314872534,0.4245201760612901,0.4162418897842208,0.4375872464053409,0.4316150415881202,0.4141608311830618,0.41940453866109145,0.4205237403737611,0.4259437457664947,0.40674423612645466,0.42909084774810596,0.42589860753549147,0.4175990165409719,0.41582839896598545,0.4071301862435203,0.4166386063608676,0.4162498610555869,0.41855635437122735,0.41491699357819123,0.40673450171037584,0.4239377379741646,0.4288944794386442,0.4148993493124296,0.40768599878982387,0.4193852960000031,0.4178658023610254,0.42471949128176223,0.40336342424630767,0.423131295125496,0.4284465201147712,0.4172552004622946,0.41165589722125606],"type":"scatter"},{"legendwidth":3,"name":" block 2","x":[1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0,9000.0,10000.0,11000.0,12000.0,13000.0,14000.0,15000.0,16000.0,17000.0,18000.0,19000.0,20000.0,21000.0,22000.0,23000.0,24000.0,25000.0,26000.0,27000.0,28000.0,29000.0,30000.0,31000.0,32000.0,33000.0,34000.0,35000.0,36000.0,37000.0,38000.0,39000.0,40000.0,41000.0,42000.0,43000.0,44000.0,45000.0,46000.0,47000.0,48000.0,49000.0,50000.0,51000.0,52000.0,53000.0,54000.0,55000.0,56000.0,57000.0,58000.0,59000.0,60000.0,61000.0,62000.0,63000.0,64000.0,65000.0,66000.0,67000.0,68000.0,69000.0,70000.0,71000.0,72000.0,73000.0,74000.0,75000.0,76000.0,77000.0,78000.0,79000.0,80000.0,81000.0,82000.0,83000.0,84000.0,85000.0,86000.0,87000.0,88000.0,89000.0,90000.0,91000.0,92000.0,93000.0,94000.0,95000.0,96000.0,97000.0],"y":[0.7229836520170793,0.530863743326416,0.4508699969195872,0.35773073126747396,0.33712336664073755,0.2854549766617637,0.24965010534992652,0.22620178778709152,0.19825033176203807,0.17132192549443367,0.15542165909030506,0.1311256162097216,0.11983693527291796,0.11118503993258401,0.10426724027509304,0.08636236934924377,0.08925114424860867,0.0746282206456157,0.07305633302701016,0.0714652289318152,0.05949244704380992,0.06279195810150666,0.059580892576670826,0.05034018549172263,0.05144289441121598,0.05062113243533192,0.04649164913663469,0.04834414203287575,0.03987707491266741,0.04556678374467008,0.04473667511074879,0.041341566836231726,0.04549169764183584,0.03823126572645957,0.03823223775074036,0.0371804967467162,0.03717967203221053,0.03732235735946295,0.038593914906468345,0.037095481926684236,0.029942092457316112,0.03666461751330114,0.033786080692203534,0.026576507624797956,0.03441201221254985,0.032510136144291636,0.03533536299445612,0.0318940556870098,0.03044323891515452,0.03168501091463886,0.028812916988770882,0.028225291579116105,0.029840287799038766,0.030082593762049508,0.0318728229503332,0.028203222643532182,0.029197103083558024,0.02787928727198,0.029166656284913575,0.02877634818004135,0.028345034978350326,0.025659447895302053,0.02886320692134388,0.025825156862027136,0.026792969944649376,0.02508289825901984,0.026906745974117467,0.03066679777110379,0.024377164257937296,0.02466479919077367,0.029082880738780535,0.024837247804117134,0.0255887250231465,0.029166616775278896,0.027948003218243672,0.02554114915817716,0.020840998609149182,0.027065530490676993,0.02553040387158735,0.02604664381621535,0.025004106765562206,0.023641814087835694,0.020333899246741238,0.024183388368729256,0.02755647081765518,0.027177429188607948,0.02423544019982982,0.02608678044198681,0.024798473895074263,0.02366266164940302,0.021217096394284672,0.02241947183133951,0.024978903978978926,0.024947919201207387,0.02163056868474301,0.023492019671053743,0.023759637163844192],"type":"scatter"},{"legendwidth":3,"name":" block 3","x":[1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0,9000.0,10000.0,11000.0,12000.0,13000.0,14000.0,15000.0,16000.0,17000.0,18000.0,19000.0,20000.0,21000.0,22000.0,23000.0,24000.0,25000.0,26000.0,27000.0,28000.0,29000.0,30000.0,31000.0,32000.0,33000.0,34000.0,35000.0,36000.0,37000.0,38000.0,39000.0,40000.0,41000.0,42000.0,43000.0,44000.0,45000.0,46000.0,47000.0,48000.0,49000.0,50000.0,51000.0,52000.0,53000.0,54000.0,55000.0,56000.0,57000.0,58000.0,59000.0,60000.0,61000.0,62000.0,63000.0,64000.0,65000.0,66000.0,67000.0,68000.0,69000.0,70000.0,71000.0,72000.0,73000.0,74000.0,75000.0,76000.0,77000.0,78000.0,79000.0,80000.0,81000.0,82000.0,83000.0,84000.0,85000.0,86000.0,87000.0,88000.0,89000.0,90000.0,91000.0,92000.0,93000.0,94000.0,95000.0,96000.0,97000.0],"y":[0.8433747150942683,0.6671036101341088,0.5307124264045133,0.4503013466138116,0.39468407025766367,0.3464810396724336,0.3044515543658752,0.24717202550475026,0.23127736924839193,0.19682523720769993,0.1689789678985878,0.14868146051126566,0.1297958198113448,0.126525910365644,0.11121194390353141,0.10266214237022639,0.09755868942517443,0.09087168003862857,0.0814845584552159,0.07872690717214335,0.07550727795035614,0.08027365455967209,0.07342782147102482,0.07620559396445407,0.06674873133881655,0.07335025579901291,0.06660078532781404,0.06342307385997935,0.06683058103217161,0.06698964829820041,0.058890685883900735,0.06784741775847994,0.058534703357125864,0.06444121459163651,0.0660471233999969,0.05825959838700303,0.059431428689898085,0.06771871870616926,0.06625532236704777,0.060447917335829694,0.061702449676851234,0.06578003453024114,0.05225785393522466,0.06497469662214833,0.06646148651830804,0.06438535277481376,0.061620187765481525,0.06474799634075679,0.06888767773166819,0.05824573745344489,0.06408088793993207,0.06311577084019636,0.055364495116883634,0.06174047668739677,0.06568022483366702,0.058372973681106895,0.06569471176818652,0.060655756134803666,0.06764538330691235,0.06611906741042221,0.05938042674477095,0.05982507174814092,0.06111039154043258,0.05974460362281808,0.05797796394272148,0.06323790822950394,0.05592634120747605,0.06677835879531734,0.06490744488616461,0.06318688060356462,0.06803042128935546,0.0655247621026504,0.06330699014174024,0.06799380128155963,0.06950088037024398,0.06243826084638307,0.06460864567249941,0.056669515031152036,0.06179937107994208,0.05565478795974036,0.059292623892537116,0.06517752889973896,0.06402876638956857,0.056917393898127035,0.05646783183335402,0.061873233135139115,0.06351391420532833,0.06428590268736441,0.07490020486603521,0.06910988049512719,0.06335772955130435,0.060994286040395994,0.0661142794280524,0.060886590054476844,0.06662038401541188,0.06759999177630309,0.058394757102825066],"type":"scatter"}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"title":{"text":"Mixture of Tokens + Learnable Temperature mean entropy of controller weights vs step","x":0.5},"xaxis":{"range":[0,97000.0],"title":{"text":"training step"}},"yaxis":{"range":[0.0,1.0],"title":{"text":"normalized entropy"}}},                        {"responsive": true}                    )                };                            </script>        </div>


<p>Interestingly, this comes at a cost of model performance.</p>


<meta charset="utf-8">

    <div>                            <div id="c01eeff4-2af7-4f04-9a2d-e031e193cd8e" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("c01eeff4-2af7-4f04-9a2d-e031e193cd8e")) {                    Plotly.newPlot(                        "c01eeff4-2af7-4f04-9a2d-e031e193cd8e",                        [{"name":"Mixture of Tokens","x":[1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0,9000.0,10000.0,11000.0,12000.0,13000.0,14000.0,15000.0,16000.0,17000.0,18000.0,19000.0,20000.0,21000.0,22000.0,23000.0,24000.0,25000.0,26000.0,27000.0,28000.0,29000.0,30000.0,31000.0,32000.0,33000.0,34000.0,35000.0,36000.0,37000.0,38000.0,39000.0,40000.0,41000.0,42000.0,43000.0,44000.0,45000.0,46000.0,47000.0,48000.0,49000.0,50000.0,51000.0,52000.0,53000.0,54000.0,55000.0,56000.0,57000.0,58000.0,59000.0,60000.0,61000.0,62000.0,63000.0,64000.0,65000.0,66000.0,67000.0,68000.0,69000.0,70000.0,71000.0,72000.0,73000.0,74000.0,75000.0,76000.0,77000.0,78000.0,79000.0,80000.0,81000.0,82000.0,83000.0,84000.0,85000.0,86000.0,87000.0,88000.0,89000.0,90000.0,91000.0,92000.0,93000.0,94000.0,95000.0,96000.0,97000.0,98000.0,99000.0,100000.0,101000.0],"y":[6.918517035961151,5.551436553955078,5.0994048924446105,4.791284382343292,4.6247055625915525,4.527974368095398,4.456279224872589,4.402963979721069,4.3587812805175785,4.320325888633728,4.286883773803711,4.260787344455719,4.233225079059601,4.209809429645539,4.190095009326935,4.172042701721192,4.155731592655182,4.140487894058228,4.126637262821197,4.110589207172394,4.100636847019196,4.089007250070572,4.080440891504288,4.068159204244614,4.057788845300674,4.049972422361374,4.042480718612671,4.033562863111496,4.023763687610626,4.0155852353572845,4.011307383060456,4.0032365396022795,3.9953905274868013,3.9910224938392638,3.9830223090648653,3.9790543451309204,3.9743673293590547,3.968254778146744,3.961279109239578,3.9548626294136047,3.9507014994621277,3.9479884495735167,3.9431491885185244,3.9379277470111846,3.9341268956661226,3.926838760137558,3.9223360385894774,3.9181150472164155,3.9154972441196443,3.9117663230895996,3.90666405582428,3.902803817510605,3.899450142621994,3.89549116230011,3.8926183795928955,3.8894086337089537,3.8827987551689147,3.881021465301514,3.8794152085781097,3.875662763595581,3.8697057509422303,3.8685294506549837,3.8641657972335817,3.860497103691101,3.858923060417175,3.855267280817032,3.852627447605133,3.8491425139904023,3.845853754758835,3.844241472005844,3.839265150308609,3.840915034532547,3.8346545467376707,3.834509412050247,3.8291555683612826,3.8265615458488464,3.823843043088913,3.821787975549698,3.81968749833107,3.8164778306484224,3.812446595907211,3.8122864351272585,3.806402993917465,3.8049569432735444,3.8044334149360655,3.8014086873531343,3.7983676357269287,3.7970819687843322,3.79331490278244,3.7922652232646943,3.789400108575821,3.786338768720627,3.7856433959007263,3.783725396156311,3.779744246006012,3.7791175713539125,3.777110816478729,3.7721693065166475,3.7699952456951142,3.7701578793525696,3.7672179126739502],"type":"scatter"},{"name":"Mixture of Tokens + learnable temperature","x":[1000.0,2000.0,3000.0,4000.0,5000.0,6000.0,7000.0,8000.0,9000.0,10000.0,11000.0,12000.0,13000.0,14000.0,15000.0,16000.0,17000.0,18000.0,19000.0,20000.0,21000.0,22000.0,23000.0,24000.0,25000.0,26000.0,27000.0,28000.0,29000.0,30000.0,31000.0,32000.0,33000.0,34000.0,35000.0,36000.0,37000.0,38000.0,39000.0,40000.0,41000.0,42000.0,43000.0,44000.0,45000.0,46000.0,47000.0,48000.0,49000.0,50000.0,51000.0,52000.0,53000.0,54000.0,55000.0,56000.0,57000.0,58000.0,59000.0,60000.0,61000.0,62000.0,63000.0,64000.0,65000.0,66000.0,67000.0,68000.0,69000.0,70000.0,71000.0,72000.0,73000.0,74000.0,75000.0,76000.0,77000.0,78000.0,79000.0,80000.0,81000.0,82000.0,83000.0,84000.0,85000.0,86000.0,87000.0,88000.0,89000.0,90000.0,91000.0,92000.0,93000.0,94000.0,95000.0,96000.0,97000.0,98000.0],"y":[6.961397614479065,5.527785311222076,5.083639989376068,4.787743222236633,4.615931591033935,4.518774859905243,4.447623687267304,4.394269061565399,4.351596297264099,4.3148665552139285,4.2831786742210385,4.258995296955109,4.23391444683075,4.213500856399536,4.197779324054718,4.183571853637695,4.172718603610992,4.162315162658691,4.153363065719605,4.144326208591461,4.139844332695008,4.134223731517792,4.1320511360168455,4.128011023521423,4.125094155788422,4.124519281864166,4.12172156381607,4.119281227111816,4.117195324897766,4.113595326900482,4.116644356250763,4.1153996109962465,4.114202406167984,4.114312876224518,4.11244775557518,4.112156430959701,4.1166483950614925,4.1139272215366365,4.1137141661643986,4.1126526355743405,4.1122781994342805,4.1139959030151365,4.114704311847687,4.114071372509002,4.114762283325195,4.112463498830795,4.111863212108612,4.110423413276672,4.111453009605408,4.111878177404404,4.1124672584533695,4.112732958078384,4.110842957258225,4.111398991346359,4.111745715856552,4.110214241027832,4.109309510707855,4.111585279226303,4.112042271375656,4.112441778182983,4.108191835880279,4.108944616794586,4.1057060277462005,4.103640729188919,4.104259989500045,4.102907100915909,4.102294079780578,4.102260387897491,4.099589063882828,4.100596388578415,4.096009262084961,4.098943897724151,4.094337257623672,4.0928680262565615,4.089011654376984,4.088371151685715,4.088033726453781,4.0864808559417725,4.085967931270599,4.083175613641739,4.0793143343925475,4.079367556810379,4.07477033495903,4.073304653167725,4.073782430648803,4.0708997683525086,4.068306635379791,4.064981014966965,4.060795704603195,4.060072214841843,4.057314954996109,4.05608574795723,4.056312828063965,4.055731618404389,4.051531780958175,4.048383668184281,4.0453285748958585,4.044117529153824],"type":"scatter"}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"title":{"text":"Training Loss vs Step","x":0.5},"xaxis":{"range":[0,90000],"title":{"text":"training step"}},"yaxis":{"range":[3.5,5],"title":{"text":"loss"}}},                        {"responsive": true}                    )                };                            </script>        </div>


<p>Thus, allowing the temperature to be learned near the end of training seems to be a very promising direction for “private” autoregressive decoding: this way, we retain all the benefits of training with a high rate of token mixing, and have very low rates during inference.</p>
<p><span class="SA"># TODO: dodać uczalną temperaturę na koniec treningu (te eksperymenty już mamy)</span></p>
<p><span class="MK">obrazki z różnymi temperaturami softmax</span></p>
</section>
</section>
<section id="conclusions-sj" class="level1">
<h1>Conclusions SJ</h1>
<p>We have shown the preliminary results showing the promise of Mixture of Tokens improving both the stability of training and final performance of the model. More thorough experiments are underway at the moment and we plan to release the paper with more results in the coming weeks. In the meantime, you can contact us with any feedback you have at llm.random.team@gmail.com .<span class="SJ">add twitter begging rwetweet us.</span></p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-clark2022unified" class="csl-entry" role="listitem">
Clark, Aidan, Diego de las Casas, Aurelia Guy, Arthur Mensch, Michela Paganini, Jordan Hoffmann, Bogdan Damoc, et al. 2022. <span>“Unified Scaling Laws for Routed Language Models.”</span> <a href="https://arxiv.org/abs/2202.01169">https://arxiv.org/abs/2202.01169</a>.
</div>
<div id="ref-du2022glam" class="csl-entry" role="listitem">
Du, Nan, Yanping Huang, Andrew M. Dai, Simon Tong, Dmitry Lepikhin, Yuanzhong Xu, Maxim Krikun, et al. 2022. <span>“GLaM: Efficient Scaling of Language Models with Mixture-of-Experts.”</span> <a href="https://arxiv.org/abs/2112.06905">https://arxiv.org/abs/2112.06905</a>.
</div>
<div id="ref-fedus2022switch" class="csl-entry" role="listitem">
Fedus, William, Barret Zoph, and Noam Shazeer. 2022. <span>“Switch Transformers: Scaling to Trillion Parameter Models with Simple and Efficient Sparsity.”</span> <a href="https://arxiv.org/abs/2101.03961">https://arxiv.org/abs/2101.03961</a>.
</div>
<div id="ref-hoffmann2022training" class="csl-entry" role="listitem">
Hoffmann, Jordan, Sebastian Borgeaud, Arthur Mensch, Elena Buchatskaya, Trevor Cai, Eliza Rutherford, Diego de Las Casas, et al. 2022. <span>“Training Compute-Optimal Large Language Models.”</span> <a href="https://arxiv.org/abs/2203.15556">https://arxiv.org/abs/2203.15556</a>.
</div>
<div id="ref-jaszczur2021sparse" class="csl-entry" role="listitem">
Jaszczur, Sebastian, Aakanksha Chowdhery, Afroz Mohiuddin, Łukasz Kaiser, Wojciech Gajewski, Henryk Michalewski, and Jonni Kanerva. 2021. <span>“Sparse Is Enough in Scaling Transformers.”</span> <a href="https://arxiv.org/abs/2111.12763">https://arxiv.org/abs/2111.12763</a>.
</div>
<div id="ref-kaplan2020scaling" class="csl-entry" role="listitem">
Kaplan, Jared, Sam McCandlish, Tom Henighan, Tom B. Brown, Benjamin Chess, Rewon Child, Scott Gray, Alec Radford, Jeffrey Wu, and Dario Amodei. 2020. <span>“Scaling Laws for Neural Language Models.”</span> <a href="https://arxiv.org/abs/2001.08361">https://arxiv.org/abs/2001.08361</a>.
</div>
<div id="ref-muqeeth2023soft" class="csl-entry" role="listitem">
Muqeeth, Mohammed, Haokun Liu, and Colin Raffel. 2023. <span>“Soft Merging of Experts with Adaptive Routing.”</span> <a href="https://arxiv.org/abs/2306.03745">https://arxiv.org/abs/2306.03745</a>.
</div>
<div id="ref-nawrot2022hierarchical" class="csl-entry" role="listitem">
Nawrot, Piotr, Szymon Tworkowski, Michał Tyrolski, Łukasz Kaiser, Yuhuai Wu, Christian Szegedy, and Henryk Michalewski. 2022. <span>“Hierarchical Transformers Are More Efficient Language Models.”</span> <a href="https://arxiv.org/abs/2110.13711">https://arxiv.org/abs/2110.13711</a>.
</div>
<div id="ref-puigcerver2023sparse" class="csl-entry" role="listitem">
Puigcerver, Joan, Carlos Riquelme, Basil Mustafa, and Neil Houlsby. 2023. <span>“From Sparse to Soft Mixtures of Experts.”</span> <a href="https://arxiv.org/abs/2308.00951">https://arxiv.org/abs/2308.00951</a>.
</div>
<div id="ref-rae2022scaling" class="csl-entry" role="listitem">
Rae, Jack W., Sebastian Borgeaud, Trevor Cai, Katie Millican, Jordan Hoffmann, Francis Song, John Aslanides, et al. 2022. <span>“Scaling Language Models: Methods, Analysis &amp; Insights from Training Gopher.”</span> <a href="https://arxiv.org/abs/2112.11446">https://arxiv.org/abs/2112.11446</a>.
</div>
<div id="ref-2019t5" class="csl-entry" role="listitem">
Raffel, Colin, Noam Shazeer, Adam Roberts, Katherine Lee, Sharan Narang, Michael Matena, Yanqi Zhou, Wei Li, and Peter J. Liu. 2019. <span>“Exploring the Limits of Transfer Learning with a Unified Text-to-Text Transformer.”</span> <em>arXiv e-Prints</em>. <a href="https://arxiv.org/abs/1910.10683">https://arxiv.org/abs/1910.10683</a>.
</div>
<div id="ref-shazeer2017outrageously" class="csl-entry" role="listitem">
Shazeer, Noam, Azalia Mirhoseini, Krzysztof Maziarz, Andy Davis, Quoc Le, Geoffrey Hinton, and Jeff Dean. 2017. <span>“Outrageously Large Neural Networks: The Sparsely-Gated Mixture-of-Experts Layer.”</span> <a href="https://arxiv.org/abs/1701.06538">https://arxiv.org/abs/1701.06538</a>.
</div>
<div id="ref-strubell2019energy" class="csl-entry" role="listitem">
Strubell, Emma, Ananya Ganesh, and Andrew McCallum. 2019. <span>“Energy and Policy Considerations for Deep Learning in NLP.”</span> <a href="https://arxiv.org/abs/1906.02243">https://arxiv.org/abs/1906.02243</a>.
</div>
<div id="ref-zhou2022mixtureofexperts" class="csl-entry" role="listitem">
Zhou, Yanqi, Tao Lei, Hanxiao Liu, Nan Du, Yanping Huang, Vincent Zhao, Andrew Dai, Zhifeng Chen, Quoc Le, and James Laudon. 2022. <span>“Mixture-of-Experts with Expert Choice Routing.”</span> <a href="https://arxiv.org/abs/2202.09368">https://arxiv.org/abs/2202.09368</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>